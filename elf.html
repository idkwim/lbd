

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ELF Support &mdash; Tutorial: Creating an LLVM Backend for the Cpu0 Architecture</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '3.3.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="Tutorial: Creating an LLVM Backend for the Cpu0 Architecture" href="index.html" />
    <link rel="next" title="Run backend" href="runbackend.html" />
    <link rel="prev" title="Function call" href="funccall.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>Tutorial: Creating an LLVM Backend for the Cpu0 Architecture</span></a></h1>
        <h2 class="heading"><span>ELF Support</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="funccall.html">Function call</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="runbackend.html">Run backend</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="elf-support">
<span id="sec-elf"></span><h1>ELF Support<a class="headerlink" href="#elf-support" title="Permalink to this headline">¶</a></h1>
<p>Cpu0 backend generated the ELF format of obj.
The ELF (Executable and Linkable Format) is a common standard file format for
executables, object code, shared libraries and core dumps.
First published in the System V Application Binary Interface specification,
and later in the Tool Interface Standard, it was quickly accepted among
different vendors of Unixsystems.
In 1999 it was chosen as the standard binary file format for Unix and
Unix-like systems on x86 by the x86open project.
Please reference <a class="footnote-reference" href="#id8" id="id1">[1]</a>.</p>
<p>The binary encode of cpu0 instruction set in obj has been checked in the
previous chapters.
But we didn&#8217;t dig into the ELF file format like elf header and relocation
record at that time.
This chapter will use the binutils which has been installed in
&#8220;sub-section Install other tools on iMac&#8221; of Appendix A: “Installing LLVM”
<a class="footnote-reference" href="#id9" id="id2">[2]</a> to analysis cpu0 ELF file.
You will learn the objdump, readelf, ..., tools and understand the ELF file
format itself through using these tools to analyze the cpu0 generated obj in
this chapter.
LLVM has the llvm-objdump tool which like objdump. We will make cpu0 support
llvm-objdump tool in this chapter.
The binutils support other CPU ELF dump as a cross compiler tool chains.
Linux platform has binutils already and no need to install it further.
We use Linux binutils in this chapter just because iMac will display Chinese
text.
The iMac corresponding binutils have no problem except it use add g in
command, for example, use gobjdump instead of objdump, and display your area
language instead of pure English.</p>
<p>The binutils tool we use is not a part of llvm tools, but it&#8217;s a powerful tool
in ELF analysis.
This chapter introduce the tool to readers since we think it is a valuable
knowledge in this popular ELF format and the ELF binutils analysis tool.
An LLVM compiler engineer has the responsibility to analyze the ELF since
the obj is need to be handled by linker or loader later.
With this tool, you can verify your generated ELF format.</p>
<p>The cpu0 author has published a “System Software” book which introduce the
topics
of assembler, linker, loader, compiler and OS in concept, and at same time
demonstrate how to use binutils and gcc to analysis ELF through the example
code in his book.
It&#8217;s a Chinese book of “System Software” in concept and practice.
This book does the real analysis through binutils.
The “System Software”<a class="footnote-reference" href="#id10" id="id3">[3]</a> written by Beck is a famous book in concept of
telling readers what is the compiler output, what is the linker output,
what is the loader output, and how they work together.
But it covers the concept only.
You can reference it to understand how the <strong>“Relocation Record”</strong> works if you
need to refresh or learning this knowledge for this chapter.</p>
<p><a class="footnote-reference" href="#id11" id="id4">[4]</a>, <a class="footnote-reference" href="#id12" id="id5">[5]</a>, <a class="footnote-reference" href="#id13" id="id6">[6]</a> are the Chinese documents available from the cpu0 author on
web site.</p>
<div class="section" id="elf-format">
<h2>ELF format<a class="headerlink" href="#elf-format" title="Permalink to this headline">¶</a></h2>
<p>ELF is a format used both in obj and executable file.
So, there are two views in it as <a class="pageref" href="#elf-f1">Figure  1</a>.</p>
<div class="figure align-center" id="elf-f1">
<a class="reference internal image-reference" href="_images/12.png"><img alt="_images/12.png" src="_images/12.png" style="width: 213.0px; height: 320.0px;" /></a>
<p class="caption">Figure 1: ELF file format overview</p>
</div>
<p>As <a class="pageref" href="#elf-f1">Figure  1</a>, the “Section header table” include sections .text, .rodata,
..., .data which are sections layout for code, read only data, ..., and
read/write data.
“Program header table” include segments include run time code and data.
The definition of segments is run time layout for code and data, and sections
is link time layout for code and data.</p>
</div>
<div class="section" id="elf-header-and-section-header-table">
<h2>ELF header and Section header table<a class="headerlink" href="#elf-header-and-section-header-table" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s run Chapter7_7/ with ch6_1.cpp, and dump ELF header information by
<tt class="docutils literal"><span class="pre">readelf</span> <span class="pre">-h</span></tt> to see what information the ELF header contains.</p>
<div class="highlight-bash"><pre>[Gamma@localhost InputFiles]$ /usr/local/llvm/test/cmake_debug_build/
bin/llc -march=cpu0 -relocation-model=pic -filetype=obj ch6_1.bc -o ch6_1.cpu0.o

[Gamma@localhost InputFiles]$ readelf -h ch6_1.cpu0.o
ELF Header:
  Magic:   7f 45 4c 46 01 02 01 08 00 00 00 00 00 00 00 00
  Class:                             ELF32
  Data:                              2's complement, big endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - IRIX
  ABI Version:                       0
  Type:                              REL (Relocatable file)
  Machine:                           &lt;unknown&gt;: 0xc9
  Version:                           0x1
  Entry point address:               0x0
  Start of program headers:          0 (bytes into file)
  Start of section headers:          212 (bytes into file)
  Flags:                             0x70000001
  Size of this header:               52 (bytes)
  Size of program headers:           0 (bytes)
  Number of program headers:         0
  Size of section headers:           40 (bytes)
  Number of section headers:         10
  Section header string table index: 7
[Gamma@localhost InputFiles]$

[Gamma@localhost InputFiles]$ /usr/local/llvm/test/cmake_debug_build/
bin/llc -march=mips -relocation-model=pic -filetype=obj ch6_1.bc -o ch6_1.mips.o

[Gamma@localhost InputFiles]$ readelf -h ch6_1.mips.o
ELF Header:
  Magic:   7f 45 4c 46 01 02 01 08 00 00 00 00 00 00 00 00
  Class:                             ELF32
  Data:                              2's complement, big endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - IRIX
  ABI Version:                       0
  Type:                              REL (Relocatable file)
  Machine:                           MIPS R3000
  Version:                           0x1
  Entry point address:               0x0
  Start of program headers:          0 (bytes into file)
  Start of section headers:          212 (bytes into file)
  Flags:                             0x70000001
  Size of this header:               52 (bytes)
  Size of program headers:           0 (bytes)
  Number of program headers:         0
  Size of section headers:           40 (bytes)
  Number of section headers:         11
  Section header string table index: 8
[Gamma@localhost InputFiles]$</pre>
</div>
<p>As above ELF header display, it contains information of magic number, version,
ABI, ..., . The Machine field of cpu0 is unknown while mips is MIPSR3000.
It is because cpu0 is not a popular CPU recognized by utility readelf.
Let&#8217;s check ELF segments information as follows,</p>
<div class="highlight-bash"><pre>[Gamma@localhost InputFiles]$ readelf -l ch6_1.cpu0.o

There are no program headers in this file.
[Gamma@localhost InputFiles]$</pre>
</div>
<p>The result is in expectation because cpu0 obj is for link only, not for
execution.
So, the segments is empty.
Check ELF sections information as follows.
It contains offset and size information for every section.</p>
<div class="highlight-bash"><pre>[Gamma@localhost InputFiles]$ readelf -S ch6_1.cpu0.o
There are 10 section headers, starting at offset 0xd4:

Section Headers:
  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al
  [ 0]                   NULL            00000000 000000 000000 00      0   0  0
  [ 1] .text             PROGBITS        00000000 000034 000034 00  AX  0   0  4
  [ 2] .rel.text         REL             00000000 000310 000018 08      8   1  4
  [ 3] .data             PROGBITS        00000000 000068 000004 00  WA  0   0  4
  [ 4] .bss              NOBITS          00000000 00006c 000000 00  WA  0   0  4
  [ 5] .eh_frame         PROGBITS        00000000 00006c 000028 00   A  0   0  4
  [ 6] .rel.eh_frame     REL             00000000 000328 000008 08      8   5  4
  [ 7] .shstrtab         STRTAB          00000000 000094 00003e 00      0   0  1
  [ 8] .symtab           SYMTAB          00000000 000264 000090 10      9   6  4
  [ 9] .strtab           STRTAB          00000000 0002f4 00001b 00      0   0  1
Key to Flags:
  W (write), A (alloc), X (execute), M (merge), S (strings)
  I (info), L (link order), G (group), T (TLS), E (exclude), x (unknown)
  O (extra OS processing required) o (OS specific), p (processor specific)
[Gamma@localhost InputFiles]$</pre>
</div>
</div>
<div class="section" id="relocation-record">
<h2>Relocation Record<a class="headerlink" href="#relocation-record" title="Permalink to this headline">¶</a></h2>
<p>The cpu0 backend translate global variable as follows,</p>
<div class="highlight-bash"><pre>[Gamma@localhost InputFiles]$ clang -c ch6_1.cpp -emit-llvm -o ch6_1.bc
[Gamma@localhost InputFiles]$ /usr/local/llvm/test/cmake_debug_build/
bin/llc -march=cpu0 -relocation-model=pic -filetype=asm ch6_1.bc -o ch6_1.cpu0.s
[Gamma@localhost InputFiles]$ cat ch6_1.cpu0.s
  .section .mdebug.abi32
  .previous
  .file "ch6_1.bc"
  .text
  .globl  main
  .align  2
  .type main,@function
  .ent  main                    # @main
main:
  .cfi_startproc
  .frame  $sp,8,$lr
  .mask   0x00000000,0
  .set  noreorder
  .cpload $t9
...
  ld  $2, %got(gI)($gp)
...
  .type gI,@object              # @gI
  .data
  .globl  gI
  .align  2
gI:
  .4byte  100                     # 0x64
  .size gI, 4


[Gamma@localhost InputFiles]$ /usr/local/llvm/test/cmake_debug_build/
bin/llc -march=cpu0 -relocation-model=pic -filetype=obj ch6_1.bc -o ch6_1.cpu0.o
[Gamma@localhost InputFiles]$ objdump -s ch6_1.cpu0.o

ch6_1.cpu0.o:     file format elf32-big

Contents of section .text:
// .cpload machine instruction
 0000 09a00000 1eaa0010 09aa0000 13aa6000  ..............`.
 ...
 0020 002a0000 00220000 012d0000 09dd0008  .*..."...-......
 ...
[Gamma@localhost InputFiles]$ Jonathan$

[Gamma@localhost InputFiles]$ readelf -tr ch6_1.cpu0.o
There are 10 section headers, starting at offset 0xd4:

Section Headers:
  [Nr] Name
     Type            Addr     Off    Size   ES   Lk Inf Al
     Flags
  [ 0]
     NULL            00000000 000000 000000 00   0   0  0
     [00000000]:
  [ 1] .text
     PROGBITS        00000000 000034 000034 00   0   0  4
     [00000006]: ALLOC, EXEC
  [ 2] .rel.text
     REL             00000000 000310 000018 08   8   1  4
     [00000000]:
  [ 3] .data
     PROGBITS        00000000 000068 000004 00   0   0  4
     [00000003]: WRITE, ALLOC
  [ 4] .bss
     NOBITS          00000000 00006c 000000 00   0   0  4
     [00000003]: WRITE, ALLOC
  [ 5] .eh_frame
     PROGBITS        00000000 00006c 000028 00   0   0  4
     [00000002]: ALLOC
  [ 6] .rel.eh_frame
     REL             00000000 000328 000008 08   8   5  4
     [00000000]:
  [ 7] .shstrtab
     STRTAB          00000000 000094 00003e 00   0   0  1
     [00000000]:
  [ 8] .symtab
     SYMTAB          00000000 000264 000090 10   9   6  4
     [00000000]:
  [ 9] .strtab
     STRTAB          00000000 0002f4 00001b 00   0   0  1
     [00000000]:

Relocation section '.rel.text' at offset 0x310 contains 3 entries:
 Offset     Info    Type            Sym.Value  Sym. Name
00000000  00000805 unrecognized: 5       00000000   _gp_disp
00000008  00000806 unrecognized: 6       00000000   _gp_disp
00000020  00000609 unrecognized: 9       00000000   gI

Relocation section '.rel.eh_frame' at offset 0x328 contains 1 entries:
 Offset     Info    Type            Sym.Value  Sym. Name
0000001c  00000202 unrecognized: 2       00000000   .text
[Gamma@localhost InputFiles]$ readelf -tr ch6_1.mips.o
There are 10 section headers, starting at offset 0xd0:

Section Headers:
  [Nr] Name
     Type            Addr     Off    Size   ES   Lk Inf Al
     Flags
  [ 0]
     NULL            00000000 000000 000000 00   0   0  0
     [00000000]:
  [ 1] .text
     PROGBITS        00000000 000034 000030 00   0   0  4
     [00000006]: ALLOC, EXEC
  [ 2] .rel.text
     REL             00000000 00030c 000018 08   8   1  4
     [00000000]:
  [ 3] .data
     PROGBITS        00000000 000064 000004 00   0   0  4
     [00000003]: WRITE, ALLOC
  [ 4] .bss
     NOBITS          00000000 000068 000000 00   0   0  4
     [00000003]: WRITE, ALLOC
  [ 5] .eh_frame
     PROGBITS        00000000 000068 000028 00   0   0  4
     [00000002]: ALLOC
  [ 6] .rel.eh_frame
     REL             00000000 000324 000008 08   8   5  4
     [00000000]:
  [ 7] .shstrtab
     STRTAB          00000000 000090 00003e 00   0   0  1
     [00000000]:
  [ 8] .symtab
     SYMTAB          00000000 000260 000090 10   9   6  4
     [00000000]:
  [ 9] .strtab
     STRTAB          00000000 0002f0 00001b 00   0   0  1
     [00000000]:

Relocation section '.rel.text' at offset 0x30c contains 3 entries:
 Offset     Info    Type            Sym.Value  Sym. Name
00000000  00000805 R_MIPS_HI16       00000000   _gp_disp
00000004  00000806 R_MIPS_LO16       00000000   _gp_disp
00000018  00000609 R_MIPS_GOT16      00000000   gI

Relocation section '.rel.eh_frame' at offset 0x324 contains 1 entries:
 Offset     Info    Type            Sym.Value  Sym. Name
0000001c  00000202 R_MIPS_32         00000000   .text</pre>
</div>
<p>As depicted in <a class="reference external" href="http://jonathan2251.github.com/lbd/funccall.html#handle-gp-register-in-pic-addressing-mode">section Handle $gp register in PIC addressing mode</a>, it
translate <strong>“.cpload %reg”</strong> into the following.</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="c1">// Lower &quot;.cpload $reg&quot; to</span>
<span class="c1">//  &quot;addiu $gp, $zero, %hi(_gp_disp)&quot;</span>
<span class="c1">//  &quot;shl   $gp, $gp, 16&quot;</span>
<span class="c1">//  &quot;addiu $gp, $gp, %lo(_gp_disp)&quot;</span>
<span class="c1">//  &quot;addu  $gp, $gp, $t9&quot;</span>
</pre></div>
</div>
<p>The _gp_disp value is determined by loader. So, it&#8217;s undefined in obj.
You can find the Relocation Records for offset 0 and 8 of .text section
referred to _gp_disp value.
The offset 0 and 8 of .text section are instructions &#8220;addiu $gp, $zero,
%hi(_gp_disp)&#8221; and &#8220;addiu $gp, $gp, %lo(_gp_disp)&#8221; and their corresponding obj
encode are  09a00000 and  09aa0000.
The obj translate the %hi(_gp_disp) and %lo(_gp_disp) into 0 since when loader
load this obj into memory, loader will know the _gp_disp value at run time and
will update these two offset relocation records into the correct offset value.
You can check the cpu0 of %hi(_gp_disp) and %lo(_gp_disp) are correct by above
mips Relocation Records of R_MIPS_HI(_gp_disp) and  R_MIPS_LO(_gp_disp) even
though the cpu0 is not a CPU recognized by greadelf utilitly.
The instruction <strong>“ld $2, %got(gI)($gp)”</strong> is same since we don&#8217;t know what the
address of .data section variable will load to.
So, translate the address to 0 and made a relocation record on 0x00000020 of
.text section. Loader will change this address too.</p>
<p>Run with ch8_3_3.cpp will get the unknown result in _Z5sum_iiz and other symbol
reference as below.
Loader or linker will take care them according the relocation records compiler
generated.</p>
<div class="highlight-bash"><pre>[Gamma@localhost InputFiles]$ /usr/local/llvm/test/cmake_debug_build/
bin/llc -march=cpu0 -relocation-model=pic -filetype=obj ch8_3_3.bc -o ch8_3__3.
cpu0.o
[Gamma@localhost InputFiles]$ readelf -tr ch8_3_3.cpu0.o
There are 11 section headers, starting at offset 0x248:

Section Headers:
  [Nr] Name
     Type            Addr     Off    Size   ES   Lk Inf Al
     Flags
  [ 0]
     NULL            00000000 000000 000000 00   0   0  0
     [00000000]:
  [ 1] .text
     PROGBITS        00000000 000034 000178 00   0   0  4
     [00000006]: ALLOC, EXEC
  [ 2] .rel.text
     REL             00000000 000538 000058 08   9   1  4
     [00000000]:
  [ 3] .data
     PROGBITS        00000000 0001ac 000000 00   0   0  4
     [00000003]: WRITE, ALLOC
  [ 4] .bss
     NOBITS          00000000 0001ac 000000 00   0   0  4
     [00000003]: WRITE, ALLOC
  [ 5] .rodata.str1.1
     PROGBITS        00000000 0001ac 000008 01   0   0  1
     [00000032]: ALLOC, MERGE, STRINGS
  [ 6] .eh_frame
     PROGBITS        00000000 0001b4 000044 00   0   0  4
     [00000002]: ALLOC
  [ 7] .rel.eh_frame
     REL             00000000 000590 000010 08   9   6  4
     [00000000]:
  [ 8] .shstrtab
     STRTAB          00000000 0001f8 00004d 00   0   0  1
     [00000000]:
  [ 9] .symtab
     SYMTAB          00000000 000400 0000e0 10  10   8  4
     [00000000]:
  [10] .strtab
     STRTAB          00000000 0004e0 000055 00   0   0  1
     [00000000]:

Relocation section '.rel.text' at offset 0x538 contains 11 entries:
 Offset     Info    Type            Sym.Value  Sym. Name
00000000  00000c05 unrecognized: 5       00000000   _gp_disp
00000008  00000c06 unrecognized: 6       00000000   _gp_disp
0000001c  00000b09 unrecognized: 9       00000000   __stack_chk_guard
000000b8  00000b09 unrecognized: 9       00000000   __stack_chk_guard
000000dc  00000a0b unrecognized: b       00000000   __stack_chk_fail
000000e8  00000c05 unrecognized: 5       00000000   _gp_disp
000000f0  00000c06 unrecognized: 6       00000000   _gp_disp
00000140  0000080b unrecognized: b       00000000   _Z5sum_iiz
00000154  00000209 unrecognized: 9       00000000   $.str
00000158  00000206 unrecognized: 6       00000000   $.str
00000160  00000d0b unrecognized: b       00000000   printf

Relocation section '.rel.eh_frame' at offset 0x590 contains 2 entries:
 Offset     Info    Type            Sym.Value  Sym. Name
0000001c  00000302 unrecognized: 2       00000000   .text
00000034  00000302 unrecognized: 2       00000000   .text
[Gamma@localhost InputFiles]$ /usr/local/llvm/test/cmake_debug_build/
bin/llc -march=mips -relocation-model=pic -filetype=obj ch8_3_3.bc -o ch8_3__3.
mips.o
[Gamma@localhost InputFiles]$ readelf -tr ch8_3_3.mips.o
There are 11 section headers, starting at offset 0x254:

Section Headers:
  [Nr] Name
     Type            Addr     Off    Size   ES   Lk Inf Al
     Flags
  [ 0]
     NULL            00000000 000000 000000 00   0   0  0
     [00000000]:
  [ 1] .text
     PROGBITS        00000000 000034 000184 00   0   0  4
     [00000006]: ALLOC, EXEC
  [ 2] .rel.text
     REL             00000000 000544 000058 08   9   1  4
     [00000000]:
  [ 3] .data
     PROGBITS        00000000 0001b8 000000 00   0   0  4
     [00000003]: WRITE, ALLOC
  [ 4] .bss
     NOBITS          00000000 0001b8 000000 00   0   0  4
     [00000003]: WRITE, ALLOC
  [ 5] .rodata.str1.1
     PROGBITS        00000000 0001b8 000008 01   0   0  1
     [00000032]: ALLOC, MERGE, STRINGS
  [ 6] .eh_frame
     PROGBITS        00000000 0001c0 000044 00   0   0  4
     [00000002]: ALLOC
  [ 7] .rel.eh_frame
     REL             00000000 00059c 000010 08   9   6  4
     [00000000]:
  [ 8] .shstrtab
     STRTAB          00000000 000204 00004d 00   0   0  1
     [00000000]:
  [ 9] .symtab
     SYMTAB          00000000 00040c 0000e0 10  10   8  4
     [00000000]:
  [10] .strtab
     STRTAB          00000000 0004ec 000055 00   0   0  1
     [00000000]:

Relocation section '.rel.text' at offset 0x544 contains 11 entries:
 Offset     Info    Type            Sym.Value  Sym. Name
00000000  00000c05 R_MIPS_HI16       00000000   _gp_disp
00000004  00000c06 R_MIPS_LO16       00000000   _gp_disp
00000024  00000b09 R_MIPS_GOT16      00000000   __stack_chk_guard
000000c8  00000b09 R_MIPS_GOT16      00000000   __stack_chk_guard
000000f0  00000a0b R_MIPS_CALL16     00000000   __stack_chk_fail
00000100  00000c05 R_MIPS_HI16       00000000   _gp_disp
00000104  00000c06 R_MIPS_LO16       00000000   _gp_disp
00000134  0000080b R_MIPS_CALL16     00000000   _Z5sum_iiz
00000154  00000209 R_MIPS_GOT16      00000000   $.str
00000158  00000206 R_MIPS_LO16       00000000   $.str
0000015c  00000d0b R_MIPS_CALL16     00000000   printf

Relocation section '.rel.eh_frame' at offset 0x59c contains 2 entries:
 Offset     Info    Type            Sym.Value  Sym. Name
0000001c  00000302 R_MIPS_32         00000000   .text
00000034  00000302 R_MIPS_32         00000000   .text
[Gamma@localhost InputFiles]$</pre>
</div>
</div>
<div class="section" id="cpu0-elf-related-files">
<h2>Cpu0 ELF related files<a class="headerlink" href="#cpu0-elf-related-files" title="Permalink to this headline">¶</a></h2>
<p>Files Cpu0ELFObjectWrite.cpp and Cpu0MC*.cpp are the files take care the obj
format.
Most obj code translation are defined by Cpu0InstrInfo.td and
Cpu0RegisterInfo.td.
With these td description, LLVM translate the instruction into obj format
automatically.</p>
</div>
<div class="section" id="lld">
<h2>lld<a class="headerlink" href="#lld" title="Permalink to this headline">¶</a></h2>
<p>The lld is a project of LLVM linker.
It&#8217;s under development and we cannot finish the installation by following the
web site direction.
Even with this, it&#8217;s really make sense to develop a new linker according lld web
site information.
Please visit the web site <a class="footnote-reference" href="#id14" id="id7">[7]</a>.</p>
</div>
<div class="section" id="llvm-objdump">
<h2>llvm-objdump<a class="headerlink" href="#llvm-objdump" title="Permalink to this headline">¶</a></h2>
<div class="section" id="llvm-objdump-t-r">
<h3>llvm-objdump -t -r<a class="headerlink" href="#llvm-objdump-t-r" title="Permalink to this headline">¶</a></h3>
<p>In iMac, <tt class="docutils literal"><span class="pre">gobjdump</span> <span class="pre">-tr</span></tt> can display the information of relocation records
like <tt class="docutils literal"><span class="pre">readelf</span> <span class="pre">-tr</span></tt>. LLVM tool llvm-objdump is the same tool as objdump.
Let&#8217;s run gobjdump and llvm-objdump commands as follows to see the differences.</p>
<div class="highlight-bash"><div class="highlight"><pre>118-165-83-12:InputFiles Jonathan<span class="nv">$ </span>clang -c ch8_3_3.cpp -emit-llvm -I/
Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/
SDKs/MacOSX10.8.sdk/usr/include/ -o ch8_3_3.bc
118-165-83-10:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_build/
bin/Debug/llc -march<span class="o">=</span>cpu0 -relocation-model<span class="o">=</span>pic -filetype<span class="o">=</span>obj ch8_3_3.bc -o
ch8_3_3.cpu0.o

118-165-78-12:InputFiles Jonathan<span class="nv">$ </span>gobjdump -t -r ch8_3_3.cpu0.o

ch8_3_3.cpu0.o: file format elf32-big

SYMBOL TABLE:
00000000 l    df *ABS*        00000000 ch8_3_3.bc
00000000 l     O .rodata.str1.1       00000008 <span class="nv">$.</span>str
00000000 l    d  .text        00000000 .text
00000000 l    d  .data        00000000 .data
00000000 l    d  .bss 00000000 .bss
00000000 l    d  .rodata.str1.1       00000000 .rodata.str1.1
00000000 l    d  .eh_frame    00000000 .eh_frame
00000000 g     F .text        000000d4 _Z5sum_iiz
000000d4 g     F .text        00000074 main
00000000         *UND*        00000000 __stack_chk_fail
00000000         *UND*        00000000 __stack_chk_guard
00000000         *UND*        00000000 <span class="nb">printf</span>


RELOCATION RECORDS FOR <span class="o">[</span>.text<span class="o">]</span>:
OFFSET   TYPE              VALUE
00000008 UNKNOWN           __stack_chk_guard
00000010 UNKNOWN           __stack_chk_guard
000000d0 UNKNOWN           __stack_chk_fail
00000118 UNKNOWN           _Z5sum_iiz
00000124 UNKNOWN           <span class="nv">$.</span>str
0000012c UNKNOWN           <span class="nv">$.</span>str
00000134 UNKNOWN           <span class="nb">printf</span>


RELOCATION RECORDS FOR <span class="o">[</span>.eh_frame<span class="o">]</span>:
OFFSET   TYPE              VALUE
0000001c UNKNOWN           .text
00000034 UNKNOWN           .text


118-165-83-10:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_build/
bin/Debug/llvm-objdump -t -r ch8_3_3.cpu0.o

ch8_3_3.cpu0.o: file format ELF32-CPU0

RELOCATION RECORDS FOR <span class="o">[</span>.text<span class="o">]</span>:
0 R_CPU0_HI16 _gp_disp
8 R_CPU0_LO16 _gp_disp
28 R_CPU0_GOT16 __stack_chk_guard
188 R_CPU0_GOT16 __stack_chk_guard
224 R_CPU0_CALL24 __stack_chk_fail
236 R_CPU0_HI16 _gp_disp
244 R_CPU0_LO16 _gp_disp
324 R_CPU0_CALL24 _Z5sum_iiz
344 R_CPU0_GOT16 <span class="nv">$.</span>str
348 R_CPU0_LO16 <span class="nv">$.</span>str
356 R_CPU0_CALL24 <span class="nb">printf</span>

RELOCATION RECORDS FOR <span class="o">[</span>.eh_frame<span class="o">]</span>:
28 R_CPU0_32 .text
52 R_CPU0_32 .text

SYMBOL TABLE:
00000000 l    df *ABS*  00000000 ch8_3_3.bc
00000000 l       .rodata.str1.1 00000008 <span class="nv">$.</span>str
00000000 l    d  .text  00000000 .text
00000000 l    d  .data  00000000 .data
00000000 l    d  .bss 00000000 .bss
00000000 l    d  .rodata.str1.1 00000000 .rodata.str1.1
00000000 l    d  .eh_frame  00000000 .eh_frame
00000000 g     F .text  000000ec _Z5sum_iiz
000000ec g     F .text  00000094 main
00000000         *UND*  00000000 __stack_chk_fail
00000000         *UND*  00000000 __stack_chk_guard
00000000         *UND*  00000000 _gp_disp
00000000         *UND*  00000000 <span class="nb">printf</span>
</pre></div>
</div>
<p>The latter llvm-objdump can display the file format and relocation records
information since we add the relocation records information in ELF.h as follows,</p>
<p class="rubric">include/support/ELF.h</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="c1">// Machine architectures</span>
<span class="k">enum</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">EM_CPU0</span>          <span class="o">=</span> <span class="mi">201</span><span class="p">,</span> <span class="c1">// Document Write An LLVM Backend Tutorial For Cpu0</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="c1">// include/object/ELF.h</span>
<span class="p">...</span>
<span class="k">template</span><span class="o">&lt;</span><span class="n">support</span><span class="o">::</span><span class="n">endianness</span> <span class="n">target_endianness</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">is64Bits</span><span class="o">&gt;</span>
<span class="n">error_code</span> <span class="n">ELFObjectFile</span><span class="o">&lt;</span><span class="n">target_endianness</span><span class="p">,</span> <span class="n">is64Bits</span><span class="o">&gt;</span>
            <span class="o">::</span><span class="n">getRelocationTypeName</span><span class="p">(</span><span class="n">DataRefImpl</span> <span class="n">Rel</span><span class="p">,</span>
                      <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Result</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">Header</span><span class="o">-&gt;</span><span class="n">e_machine</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">ELF</span><span class="o">::</span><span class="nl">EM_CPU0:</span>  <span class="c1">// llvm-objdump -t -r</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_NONE</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_16</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_32</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_REL32</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_24</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_HI16</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_LO16</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_GPREL16</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_LITERAL</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_GOT16</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_PC24</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_CALL24</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_GPREL32</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_SHIFT5</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_SHIFT6</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_64</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_GOT_DISP</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_GOT_PAGE</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_GOT_OFST</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_GOT_HI16</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_GOT_LO16</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_SUB</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_INSERT_A</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_INSERT_B</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_DELETE</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_HIGHER</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_HIGHEST</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_CALL_HI16</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_CALL_LO16</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_SCN_DISP</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_REL16</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_ADD_IMMEDIATE</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_PJUMP</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_RELGOT</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_JALR</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_TLS_DTPMOD32</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_TLS_DTPREL32</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_TLS_DTPMOD64</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_TLS_DTPREL64</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_TLS_GD</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_TLS_LDM</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_TLS_DTPREL_HI16</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_TLS_DTPREL_LO16</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_TLS_GOTTPREL</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_TLS_TPREL32</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_TLS_TPREL64</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_TLS_TPREL_HI16</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_TLS_TPREL_LO16</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_GLOB_DAT</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_COPY</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_JUMP_SLOT</span><span class="p">);</span>
    <span class="n">LLVM_ELF_SWITCH_RELOC_TYPE_NAME</span><span class="p">(</span><span class="n">R_CPU0_NUM</span><span class="p">);</span>
  <span class="k">default</span><span class="o">:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="s">&quot;Unknown&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">break</span><span class="p">;</span>
  <span class="p">...</span>
  <span class="p">}</span>


<span class="k">template</span><span class="o">&lt;</span><span class="n">support</span><span class="o">::</span><span class="n">endianness</span> <span class="n">target_endianness</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">is64Bits</span><span class="o">&gt;</span>
<span class="n">error_code</span> <span class="n">ELFObjectFile</span><span class="o">&lt;</span><span class="n">target_endianness</span><span class="p">,</span> <span class="n">is64Bits</span><span class="o">&gt;</span>
            <span class="o">::</span><span class="n">getRelocationValueString</span><span class="p">(</span><span class="n">DataRefImpl</span> <span class="n">Rel</span><span class="p">,</span>
                      <span class="n">SmallVectorImpl</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Result</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">case</span> <span class="n">ELF</span><span class="o">::</span><span class="nl">EM_CPU0:</span>  <span class="c1">// llvm-objdump -t -r</span>
  <span class="n">res</span> <span class="o">=</span> <span class="n">symname</span><span class="p">;</span>
  <span class="k">break</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="n">support</span><span class="o">::</span><span class="n">endianness</span> <span class="n">target_endianness</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">is64Bits</span><span class="o">&gt;</span>
<span class="n">StringRef</span> <span class="n">ELFObjectFile</span><span class="o">&lt;</span><span class="n">target_endianness</span><span class="p">,</span> <span class="n">is64Bits</span><span class="o">&gt;</span>
             <span class="o">::</span><span class="n">getFileFormatName</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
  <span class="k">switch</span><span class="p">(</span><span class="n">Header</span><span class="o">-&gt;</span><span class="n">e_ident</span><span class="p">[</span><span class="n">ELF</span><span class="o">::</span><span class="n">EI_CLASS</span><span class="p">])</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">ELF</span><span class="o">::</span><span class="nl">ELFCLASS32:</span>
  <span class="k">switch</span><span class="p">(</span><span class="n">Header</span><span class="o">-&gt;</span><span class="n">e_machine</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">case</span> <span class="n">ELF</span><span class="o">::</span><span class="nl">EM_CPU0:</span>  <span class="c1">// llvm-objdump -t -r</span>
    <span class="k">return</span> <span class="s">&quot;ELF32-CPU0&quot;</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="n">support</span><span class="o">::</span><span class="n">endianness</span> <span class="n">target_endianness</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">is64Bits</span><span class="o">&gt;</span>
<span class="kt">unsigned</span> <span class="n">ELFObjectFile</span><span class="o">&lt;</span><span class="n">target_endianness</span><span class="p">,</span> <span class="n">is64Bits</span><span class="o">&gt;::</span><span class="n">getArch</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
  <span class="k">switch</span><span class="p">(</span><span class="n">Header</span><span class="o">-&gt;</span><span class="n">e_machine</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">case</span> <span class="n">ELF</span><span class="o">::</span><span class="nl">EM_CPU0:</span>  <span class="c1">// llvm-objdump -t -r</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">target_endianness</span> <span class="o">==</span> <span class="n">support</span><span class="o">::</span><span class="n">little</span><span class="p">)</span> <span class="o">?</span>
       <span class="n">Triple</span><span class="o">::</span><span class="n">cpu0el</span> <span class="o">:</span> <span class="n">Triple</span><span class="o">::</span><span class="n">cpu0</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="llvm-objdump-d">
<h3>llvm-objdump -d<a class="headerlink" href="#llvm-objdump-d" title="Permalink to this headline">¶</a></h3>
<p>Run Chapter8_9/ and command <tt class="docutils literal"><span class="pre">llvm-objdump</span> <span class="pre">-d</span></tt> for dump file from elf to hex as
follows,</p>
<div class="highlight-bash"><div class="highlight"><pre>JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span>clang -c ch7_1_1.cpp -emit-llvm -o
ch7_1_1.bc
JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_
build/bin/Debug/llc -march<span class="o">=</span>cpu0 -relocation-model<span class="o">=</span>pic -filetype<span class="o">=</span>obj ch7_1_1.bc
-o ch7_1_1.cpu0.o
JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_
build/bin/Debug/llvm-objdump -d ch7_1_1.cpu0.o

ch7_1_1.cpu0.o: file format ELF32-unknown

Disassembly of section .text:error: no disassembler <span class="k">for </span>target cpu0-unknown-
unknown
</pre></div>
</div>
<p>To support llvm-objdump, the following code added to Chapter9_1/.</p>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter9_1/CMakeLists.txt</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">tablegen</span><span class="p">(</span><span class="n">LLVM</span> <span class="n">Cpu0GenDisassemblerTables</span><span class="p">.</span><span class="n">inc</span> <span class="o">-</span><span class="n">gen</span><span class="o">-</span><span class="n">disassembler</span><span class="p">)</span>
<span class="p">...</span>
</pre></div>
</div>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter9_1/LLVMBuild.txt</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="p">[</span><span class="n">common</span><span class="p">]</span>
<span class="n">subdirectories</span> <span class="o">=</span> <span class="n">Disassembler</span> <span class="p">...</span>
<span class="p">...</span>
<span class="n">has_disassembler</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">...</span>
</pre></div>
</div>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter9_1/Cpu0InstrInfo.td</p>
<div class="highlight-c++"><pre>class CmpInstr&lt;bits&lt;8&gt; op, string instr_asm,
         InstrItinClass itin, RegisterClass RC, RegisterClass RD,
         bit isComm = 0&gt;:
  FA&lt;op, (outs RD:$rc), (ins RC:$ra, RC:$rb),
   !strconcat(instr_asm, "\t$ra, $rb"), [], itin&gt; {
  ...
  let DecoderMethod = "DecodeCMPInstruction";
}

class CBranch&lt;bits&lt;8&gt; op, string instr_asm, RegisterClass RC,
           list&lt;Register&gt; UseRegs&gt;:
  FJ&lt;op, (outs), (ins RC:$ra, brtarget:$addr),
       !strconcat(instr_asm, "\t$addr"),
       [], IIBranch&gt; {
  ...
  let DecoderMethod = "DecodeBranchTarget";
}

let isBranch=1, isTerminator=1, isBarrier=1, imm16=0, hasDelaySlot = 1,
  isIndirectBranch = 1 in
class JumpFR&lt;bits&lt;8&gt; op, string instr_asm, RegisterClass RC&gt;:
  FL&lt;op, (outs), (ins RC:$ra),
   !strconcat(instr_asm, "\t$ra"), [(brind RC:$ra)], IIBranch&gt; {
  let rb = 0;
  let imm16 = 0;
}

let isCall=1, hasDelaySlot=0 in {
  class JumpLink&lt;bits&lt;8&gt; op, string instr_asm&gt;:
  FJ&lt;op, (outs), (ins calltarget:$target, variable_ops),
     !strconcat(instr_asm, "\t$target"), [(Cpu0JmpLink imm:$target)],
     IIBranch&gt; {
     let DecoderMethod = "DecodeJumpAbsoluteTarget";
     }

def JR      : JumpFR&lt;0x2C, "ret", CPURegs&gt;;</pre>
</div>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter9_1/Disassembler/CMakeLists.txt</p>
<div class="highlight-c++"><pre>include_directories( ${CMAKE_CURRENT_BINARY_DIR}/.. ${CMAKE_CURRENT_SOURCE_DIR}/.. )

add_llvm_library(LLVMCpu0Disassembler
  Cpu0Disassembler.cpp
  )

# workaround for hanging compilation on MSVC9 and 10
if( MSVC_VERSION EQUAL 1400 OR MSVC_VERSION EQUAL 1500 OR MSVC_VERSION EQUAL 1600 )
set_property(
  SOURCE Cpu0Disassembler.cpp
  PROPERTY COMPILE_FLAGS "/Od"
  )
endif()

add_dependencies(LLVMCpu0Disassembler Cpu0CommonTableGen)
</pre>
</div>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter9_1/Disassembler/LLVMBuild.txt</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="p">;</span><span class="o">===-</span> <span class="p">.</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">Target</span><span class="o">/</span><span class="n">Cpu0</span><span class="o">/</span><span class="n">Disassembler</span><span class="o">/</span><span class="n">LLVMBuild</span><span class="p">.</span><span class="n">txt</span> <span class="o">--------------*-</span> <span class="n">Conf</span> <span class="o">-*--===</span><span class="p">;</span>
<span class="p">;</span>
<span class="p">;</span>                     <span class="n">The</span> <span class="n">LLVM</span> <span class="n">Compiler</span> <span class="n">Infrastructure</span>
<span class="p">;</span>
<span class="p">;</span> <span class="n">This</span> <span class="n">file</span> <span class="n">is</span> <span class="n">distributed</span> <span class="n">under</span> <span class="n">the</span> <span class="n">University</span> <span class="n">of</span> <span class="n">Illinois</span> <span class="n">Open</span> <span class="n">Source</span>
<span class="p">;</span> <span class="n">License</span><span class="p">.</span> <span class="n">See</span> <span class="n">LICENSE</span><span class="p">.</span><span class="n">TXT</span> <span class="k">for</span> <span class="n">details</span><span class="p">.</span>
<span class="p">;</span>
<span class="p">;</span><span class="o">===------------------------------------------------------------------------===</span><span class="p">;</span>
<span class="p">;</span>
<span class="p">;</span> <span class="n">This</span> <span class="n">is</span> <span class="n">an</span> <span class="n">LLVMBuild</span> <span class="n">description</span> <span class="n">file</span> <span class="k">for</span> <span class="n">the</span> <span class="n">components</span> <span class="n">in</span> <span class="k">this</span> <span class="n">subdirectory</span><span class="p">.</span>
<span class="p">;</span>
<span class="p">;</span> <span class="n">For</span> <span class="n">more</span> <span class="n">information</span> <span class="n">on</span> <span class="n">the</span> <span class="n">LLVMBuild</span> <span class="n">system</span><span class="p">,</span> <span class="n">please</span> <span class="nl">see:</span>
<span class="p">;</span>
<span class="p">;</span>   <span class="nl">http:</span><span class="c1">//llvm.org/docs/LLVMBuild.html</span>
<span class="p">;</span>
<span class="p">;</span><span class="o">===------------------------------------------------------------------------===</span><span class="p">;</span>

<span class="p">[</span><span class="n">component_0</span><span class="p">]</span>
<span class="n">type</span> <span class="o">=</span> <span class="n">Library</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">Cpu0Disassembler</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">Cpu0</span>
<span class="n">required_libraries</span> <span class="o">=</span> <span class="n">MC</span> <span class="n">Support</span> <span class="n">Cpu0Info</span>
<span class="n">add_to_library_groups</span> <span class="o">=</span> <span class="n">Cpu0</span>
</pre></div>
</div>
<p class="rubric">LLVMBackendTutorialExampleCode/Chapter9_1/Disassembler/Cpu0Disassembler.cpp</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="c1">//===- Cpu0Disassembler.cpp - Disassembler for Cpu0 -------------*- C++ -*-===//</span>
<span class="c1">//</span>
<span class="c1">//                     The LLVM Compiler Infrastructure</span>
<span class="c1">//</span>
<span class="c1">// This file is distributed under the University of Illinois Open Source</span>
<span class="c1">// License. See LICENSE.TXT for details.</span>
<span class="c1">//</span>
<span class="c1">//===----------------------------------------------------------------------===//</span>
<span class="c1">//</span>
<span class="c1">// This file is part of the Cpu0 Disassembler.</span>
<span class="c1">//</span>
<span class="c1">//===----------------------------------------------------------------------===//</span>

<span class="cp">#include &quot;Cpu0.h&quot;</span>
<span class="cp">#include &quot;Cpu0Subtarget.h&quot;</span>
<span class="cp">#include &quot;Cpu0RegisterInfo.h&quot;</span>
<span class="cp">#include &quot;llvm/MC/MCDisassembler.h&quot;</span>
<span class="cp">#include &quot;llvm/MC/MCFixedLenDisassembler.h&quot;</span>
<span class="cp">#include &quot;llvm/Support/MemoryObject.h&quot;</span>
<span class="cp">#include &quot;llvm/Support/TargetRegistry.h&quot;</span>
<span class="cp">#include &quot;llvm/MC/MCSubtargetInfo.h&quot;</span>
<span class="cp">#include &quot;llvm/MC/MCInst.h&quot;</span>
<span class="cp">#include &quot;llvm/Support/MathExtras.h&quot;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">llvm</span><span class="p">;</span>

<span class="k">typedef</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">DecodeStatus</span> <span class="n">DecodeStatus</span><span class="p">;</span>

<span class="c1">/// Cpu0Disassembler - a disasembler class for Cpu032.</span>
<span class="k">class</span> <span class="nc">Cpu0Disassembler</span> <span class="o">:</span> <span class="k">public</span> <span class="n">MCDisassembler</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">/// Constructor     - Initializes the disassembler.</span>
  <span class="c1">///</span>
  <span class="n">Cpu0Disassembler</span><span class="p">(</span><span class="k">const</span> <span class="n">MCSubtargetInfo</span> <span class="o">&amp;</span><span class="n">STI</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">bigEndian</span><span class="p">)</span> <span class="o">:</span>
    <span class="n">MCDisassembler</span><span class="p">(</span><span class="n">STI</span><span class="p">),</span> <span class="n">isBigEndian</span><span class="p">(</span><span class="n">bigEndian</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">}</span>

  <span class="o">~</span><span class="n">Cpu0Disassembler</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">}</span>

  <span class="c1">/// getInstruction - See MCDisassembler.</span>
  <span class="n">DecodeStatus</span> <span class="n">getInstruction</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">instr</span><span class="p">,</span>
                              <span class="n">uint64_t</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">,</span>
                              <span class="k">const</span> <span class="n">MemoryObject</span> <span class="o">&amp;</span><span class="n">region</span><span class="p">,</span>
                              <span class="n">uint64_t</span> <span class="n">address</span><span class="p">,</span>
                              <span class="n">raw_ostream</span> <span class="o">&amp;</span><span class="n">vStream</span><span class="p">,</span>
                              <span class="n">raw_ostream</span> <span class="o">&amp;</span><span class="n">cStream</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>

<span class="k">private</span><span class="o">:</span>
  <span class="kt">bool</span> <span class="n">isBigEndian</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Decoder tables for Cpu0 register</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">CPURegsTable</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">Cpu0</span><span class="o">::</span><span class="n">ZERO</span><span class="p">,</span> <span class="n">Cpu0</span><span class="o">::</span><span class="n">AT</span><span class="p">,</span> <span class="n">Cpu0</span><span class="o">::</span><span class="n">V0</span><span class="p">,</span> <span class="n">Cpu0</span><span class="o">::</span><span class="n">V1</span><span class="p">,</span>
  <span class="n">Cpu0</span><span class="o">::</span><span class="n">A0</span><span class="p">,</span> <span class="n">Cpu0</span><span class="o">::</span><span class="n">A1</span><span class="p">,</span> <span class="n">Cpu0</span><span class="o">::</span><span class="n">T9</span><span class="p">,</span> <span class="n">Cpu0</span><span class="o">::</span><span class="n">S0</span><span class="p">,</span> 
  <span class="n">Cpu0</span><span class="o">::</span><span class="n">S1</span><span class="p">,</span> <span class="n">Cpu0</span><span class="o">::</span><span class="n">S2</span><span class="p">,</span> <span class="n">Cpu0</span><span class="o">::</span><span class="n">GP</span><span class="p">,</span> <span class="n">Cpu0</span><span class="o">::</span><span class="n">FP</span><span class="p">,</span> 
  <span class="n">Cpu0</span><span class="o">::</span><span class="n">SW</span><span class="p">,</span> <span class="n">Cpu0</span><span class="o">::</span><span class="n">SP</span><span class="p">,</span> <span class="n">Cpu0</span><span class="o">::</span><span class="n">LR</span><span class="p">,</span> <span class="n">Cpu0</span><span class="o">::</span><span class="n">PC</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">DecodeCPURegsRegisterClass</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span>
                                               <span class="kt">unsigned</span> <span class="n">RegNo</span><span class="p">,</span>
                                               <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                                               <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">Decoder</span><span class="p">);</span>
<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">DecodeCMPInstruction</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span>
                                       <span class="kt">unsigned</span> <span class="n">Insn</span><span class="p">,</span>
                                       <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                                       <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">Decoder</span><span class="p">);</span>
<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">DecodeBranchTarget</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span>
                                       <span class="kt">unsigned</span> <span class="n">Insn</span><span class="p">,</span>
                                       <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                                       <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">Decoder</span><span class="p">);</span>
<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">DecodeJumpRelativeTarget</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span>
                                       <span class="kt">unsigned</span> <span class="n">Insn</span><span class="p">,</span>
                                       <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                                       <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">Decoder</span><span class="p">);</span>
<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">DecodeJumpAbsoluteTarget</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span>
                                     <span class="kt">unsigned</span> <span class="n">Insn</span><span class="p">,</span>
                                     <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                                     <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">Decoder</span><span class="p">);</span>

<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">DecodeMem</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span>
                              <span class="kt">unsigned</span> <span class="n">Insn</span><span class="p">,</span>
                              <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                              <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">Decoder</span><span class="p">);</span>
<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">DecodeSimm16</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span>
                                 <span class="kt">unsigned</span> <span class="n">Insn</span><span class="p">,</span>
                                 <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                                 <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">Decoder</span><span class="p">);</span>

<span class="k">namespace</span> <span class="n">llvm</span> <span class="p">{</span>
<span class="k">extern</span> <span class="n">Target</span> <span class="n">TheCpu0elTarget</span><span class="p">,</span> <span class="n">TheCpu0Target</span><span class="p">,</span> <span class="n">TheCpu064Target</span><span class="p">,</span>
              <span class="n">TheCpu064elTarget</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">MCDisassembler</span> <span class="o">*</span><span class="n">createCpu0Disassembler</span><span class="p">(</span>
                       <span class="k">const</span> <span class="n">Target</span> <span class="o">&amp;</span><span class="n">T</span><span class="p">,</span>
                       <span class="k">const</span> <span class="n">MCSubtargetInfo</span> <span class="o">&amp;</span><span class="n">STI</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">Cpu0Disassembler</span><span class="p">(</span><span class="n">STI</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">MCDisassembler</span> <span class="o">*</span><span class="n">createCpu0elDisassembler</span><span class="p">(</span>
                       <span class="k">const</span> <span class="n">Target</span> <span class="o">&amp;</span><span class="n">T</span><span class="p">,</span>
                       <span class="k">const</span> <span class="n">MCSubtargetInfo</span> <span class="o">&amp;</span><span class="n">STI</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">Cpu0Disassembler</span><span class="p">(</span><span class="n">STI</span><span class="p">,</span><span class="kc">false</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="kt">void</span> <span class="n">LLVMInitializeCpu0Disassembler</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Register the disassembler.</span>
  <span class="n">TargetRegistry</span><span class="o">::</span><span class="n">RegisterMCDisassembler</span><span class="p">(</span><span class="n">TheCpu0Target</span><span class="p">,</span>
                                         <span class="n">createCpu0Disassembler</span><span class="p">);</span>
  <span class="n">TargetRegistry</span><span class="o">::</span><span class="n">RegisterMCDisassembler</span><span class="p">(</span><span class="n">TheCpu0elTarget</span><span class="p">,</span>
                                         <span class="n">createCpu0elDisassembler</span><span class="p">);</span>
<span class="p">}</span>


<span class="cp">#include &quot;Cpu0GenDisassemblerTables.inc&quot;</span>

  <span class="c1">/// readInstruction - read four bytes from the MemoryObject</span>
  <span class="c1">/// and return 32 bit word sorted according to the given endianess</span>
<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">readInstruction32</span><span class="p">(</span><span class="k">const</span> <span class="n">MemoryObject</span> <span class="o">&amp;</span><span class="n">region</span><span class="p">,</span>
                                      <span class="n">uint64_t</span> <span class="n">address</span><span class="p">,</span>
                                      <span class="n">uint64_t</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">,</span>
                                      <span class="n">uint32_t</span> <span class="o">&amp;</span><span class="n">insn</span><span class="p">,</span>
                                      <span class="kt">bool</span> <span class="n">isBigEndian</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">uint8_t</span> <span class="n">Bytes</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

  <span class="c1">// We want to read exactly 4 Bytes of data.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">region</span><span class="p">.</span><span class="n">readBytes</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="n">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">Bytes</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">Fail</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">isBigEndian</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Encoded as a big-endian 32-bit word in the stream.</span>
    <span class="n">insn</span> <span class="o">=</span> <span class="p">(</span><span class="n">Bytes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;&lt;</span>  <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
           <span class="p">(</span><span class="n">Bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span>  <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
           <span class="p">(</span><span class="n">Bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span>
           <span class="p">(</span><span class="n">Bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Encoded as a small-endian 32-bit word in the stream.</span>
    <span class="n">insn</span> <span class="o">=</span> <span class="p">(</span><span class="n">Bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span>  <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
           <span class="p">(</span><span class="n">Bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span>  <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
           <span class="p">(</span><span class="n">Bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span>
           <span class="p">(</span><span class="n">Bytes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">Success</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">DecodeStatus</span>
<span class="n">Cpu0Disassembler</span><span class="o">::</span><span class="n">getInstruction</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">instr</span><span class="p">,</span>
                                 <span class="n">uint64_t</span> <span class="o">&amp;</span><span class="n">Size</span><span class="p">,</span>
                                 <span class="k">const</span> <span class="n">MemoryObject</span> <span class="o">&amp;</span><span class="n">Region</span><span class="p">,</span>
                                 <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                                 <span class="n">raw_ostream</span> <span class="o">&amp;</span><span class="n">vStream</span><span class="p">,</span>
                                 <span class="n">raw_ostream</span> <span class="o">&amp;</span><span class="n">cStream</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
  <span class="n">uint32_t</span> <span class="n">Insn</span><span class="p">;</span>

  <span class="n">DecodeStatus</span> <span class="n">Result</span> <span class="o">=</span> <span class="n">readInstruction32</span><span class="p">(</span><span class="n">Region</span><span class="p">,</span> <span class="n">Address</span><span class="p">,</span> <span class="n">Size</span><span class="p">,</span>
                                          <span class="n">Insn</span><span class="p">,</span> <span class="n">isBigEndian</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Result</span> <span class="o">==</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">Fail</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">Fail</span><span class="p">;</span>

  <span class="c1">// Calling the auto-generated decoder function.</span>
  <span class="n">Result</span> <span class="o">=</span> <span class="n">decodeInstruction</span><span class="p">(</span><span class="n">DecoderTableCpu032</span><span class="p">,</span> <span class="n">instr</span><span class="p">,</span> <span class="n">Insn</span><span class="p">,</span> <span class="n">Address</span><span class="p">,</span>
                             <span class="k">this</span><span class="p">,</span> <span class="n">STI</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Result</span> <span class="o">!=</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">Fail</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">Result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">Fail</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">DecodeCPURegsRegisterClass</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span>
                                               <span class="kt">unsigned</span> <span class="n">RegNo</span><span class="p">,</span>
                                               <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                                               <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">Decoder</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">RegNo</span> <span class="o">&gt;</span> <span class="mi">16</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">Fail</span><span class="p">;</span>

  <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">CPURegsTable</span><span class="p">[</span><span class="n">RegNo</span><span class="p">]));</span>
  <span class="k">return</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">Success</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">DecodeMem</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span>
                              <span class="kt">unsigned</span> <span class="n">Insn</span><span class="p">,</span>
                              <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                              <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">Decoder</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">Offset</span> <span class="o">=</span> <span class="n">SignExtend32</span><span class="o">&lt;</span><span class="mi">16</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Insn</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">Reg</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">fieldFromInstruction</span><span class="p">(</span><span class="n">Insn</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">Base</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">fieldFromInstruction</span><span class="p">(</span><span class="n">Insn</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

  <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">CPURegsTable</span><span class="p">[</span><span class="n">Reg</span><span class="p">]));</span>
  <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">CPURegsTable</span><span class="p">[</span><span class="n">Base</span><span class="p">]));</span>
  <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">Offset</span><span class="p">));</span>

  <span class="k">return</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">Success</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* CMP instruction define $rc and then $ra, $rb; The printOperand() print </span>
<span class="cm">operand 1 and operand 2 (operand 0 is $rc and operand 1 is $ra), so we Create </span>
<span class="cm">register $rc first and create $ra next, as follows,</span>

<span class="cm">// Cpu0InstrInfo.td</span>
<span class="cm">class CmpInstr&lt;bits&lt;8&gt; op, string instr_asm, </span>
<span class="cm">                    InstrItinClass itin, RegisterClass RC, RegisterClass RD, bit isComm = 0&gt;:</span>
<span class="cm">  FA&lt;op, (outs RD:$rc), (ins RC:$ra, RC:$rb),</span>
<span class="cm">     !strconcat(instr_asm, &quot;\t$ra, $rb&quot;), [], itin&gt; {</span>

<span class="cm">// Cpu0AsmWriter.inc</span>
<span class="cm">void Cpu0InstPrinter::printInstruction(const MCInst *MI, raw_ostream &amp;O) {</span>
<span class="cm">...</span>
<span class="cm">  case 3:</span>
<span class="cm">    // CMP, JEQ, JGE, JGT, JLE, JLT, JNE</span>
<span class="cm">    printOperand(MI, 1, O); </span>
<span class="cm">    break;</span>
<span class="cm">...</span>
<span class="cm">  case 1:</span>
<span class="cm">    // CMP</span>
<span class="cm">    printOperand(MI, 2, O); </span>
<span class="cm">    return;</span>
<span class="cm">    break;</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">DecodeCMPInstruction</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span>
                                       <span class="kt">unsigned</span> <span class="n">Insn</span><span class="p">,</span>
                                       <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                                       <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">Decoder</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">Reg_a</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">fieldFromInstruction</span><span class="p">(</span><span class="n">Insn</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">Reg_b</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">fieldFromInstruction</span><span class="p">(</span><span class="n">Insn</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">Reg_c</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">fieldFromInstruction</span><span class="p">(</span><span class="n">Insn</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

  <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">CPURegsTable</span><span class="p">[</span><span class="n">Reg_c</span><span class="p">]));</span>
  <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">CPURegsTable</span><span class="p">[</span><span class="n">Reg_a</span><span class="p">]));</span>
  <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">CPURegsTable</span><span class="p">[</span><span class="n">Reg_b</span><span class="p">]));</span>
  <span class="k">return</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">Success</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* CBranch instruction define $ra and then imm24; The printOperand() print </span>
<span class="cm">operand 1 (operand 0 is $ra and operand 1 is imm24), so we Create register </span>
<span class="cm">operand first and create imm24 next, as follows,</span>

<span class="cm">// Cpu0InstrInfo.td</span>
<span class="cm">class CBranch&lt;bits&lt;8&gt; op, string instr_asm, RegisterClass RC,</span>
<span class="cm">                   list&lt;Register&gt; UseRegs&gt;:</span>
<span class="cm">  FJ&lt;op, (outs), (ins RC:$ra, brtarget:$addr),</span>
<span class="cm">             !strconcat(instr_asm, &quot;\t$addr&quot;),</span>
<span class="cm">             [(brcond RC:$ra, bb:$addr)], IIBranch&gt; {</span>

<span class="cm">// Cpu0AsmWriter.inc</span>
<span class="cm">void Cpu0InstPrinter::printInstruction(const MCInst *MI, raw_ostream &amp;O) {</span>
<span class="cm">...</span>
<span class="cm">  case 3:</span>
<span class="cm">    // CMP, JEQ, JGE, JGT, JLE, JLT, JNE</span>
<span class="cm">    printOperand(MI, 1, O); </span>
<span class="cm">    break;</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">DecodeBranchTarget</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span>
                                       <span class="kt">unsigned</span> <span class="n">Insn</span><span class="p">,</span>
                                       <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                                       <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">Decoder</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">BranchOffset</span> <span class="o">=</span> <span class="n">fieldFromInstruction</span><span class="p">(</span><span class="n">Insn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">BranchOffset</span> <span class="o">&gt;</span> <span class="mh">0x8fffff</span><span class="p">)</span>
  	<span class="n">BranchOffset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mh">0x1000000</span> <span class="o">-</span> <span class="n">BranchOffset</span><span class="p">);</span>
  <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateReg</span><span class="p">(</span><span class="n">CPURegsTable</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
  <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">BranchOffset</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">Success</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">DecodeJumpRelativeTarget</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span>
                                     <span class="kt">unsigned</span> <span class="n">Insn</span><span class="p">,</span>
                                     <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                                     <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">Decoder</span><span class="p">)</span> <span class="p">{</span>

  <span class="kt">int</span> <span class="n">JumpOffset</span> <span class="o">=</span> <span class="n">fieldFromInstruction</span><span class="p">(</span><span class="n">Insn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">JumpOffset</span> <span class="o">&gt;</span> <span class="mh">0x8fffff</span><span class="p">)</span>
  	<span class="n">JumpOffset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="mh">0x1000000</span> <span class="o">-</span> <span class="n">JumpOffset</span><span class="p">);</span>
  <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">JumpOffset</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">Success</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">DecodeJumpAbsoluteTarget</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span>
                                     <span class="kt">unsigned</span> <span class="n">Insn</span><span class="p">,</span>
                                     <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                                     <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">Decoder</span><span class="p">)</span> <span class="p">{</span>

  <span class="kt">unsigned</span> <span class="n">JumpOffset</span> <span class="o">=</span> <span class="n">fieldFromInstruction</span><span class="p">(</span><span class="n">Insn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">);</span>
  <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">JumpOffset</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">Success</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">DecodeStatus</span> <span class="n">DecodeSimm16</span><span class="p">(</span><span class="n">MCInst</span> <span class="o">&amp;</span><span class="n">Inst</span><span class="p">,</span>
                                 <span class="kt">unsigned</span> <span class="n">Insn</span><span class="p">,</span>
                                 <span class="n">uint64_t</span> <span class="n">Address</span><span class="p">,</span>
                                 <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">Decoder</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Inst</span><span class="p">.</span><span class="n">addOperand</span><span class="p">(</span><span class="n">MCOperand</span><span class="o">::</span><span class="n">CreateImm</span><span class="p">(</span><span class="n">SignExtend32</span><span class="o">&lt;</span><span class="mi">16</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Insn</span><span class="p">)));</span>
  <span class="k">return</span> <span class="n">MCDisassembler</span><span class="o">::</span><span class="n">Success</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As above code, it add directory Disassembler for handling the obj to assembly
code reverse translation. So, add Disassembler/Cpu0Disassembler.cpp and modify
the CMakeList.txt and LLVMBuild.txt to build with directory Disassembler and
enable the disassembler table generated by &#8220;has_disassembler = 1&#8221;.
Most of code is handled by the table of *.td files defined.
Not every instruction in *.td can be disassembled without trouble even though
they can be translated into assembly and obj successfully.
For those cannot be disassembled, LLVM supply the <strong>&#8220;let DecoderMethod&#8221;</strong>
keyword to allow programmers implement their decode function.
In Cpu0 example, we define function DecodeCMPInstruction(), DecodeBranchTarget()
and DecodeJumpAbsoluteTarget() in Cpu0Disassembler.cpp and tell the LLVM table
driven system by write <strong>&#8220;let DecoderMethod = ...&#8221;</strong> in the corresponding
instruction definitions or ISD node of Cpu0InstrInfo.td.
LLVM will call these DecodeMethod when user use Disassembler job in tools, like
<tt class="docutils literal"><span class="pre">llvm-objdump</span> <span class="pre">-d</span></tt>.
You can check the comments above these DecodeMethod functions to see how it
work.
For the CMP instruction, since there are 3 operand $rc, $ra and $rb occurs in
CmpInstr&lt;...&gt;, and the assembler print $ra and $rb.
LLVM table generate system will print operand 1 and 2
($ra and $rb) in the table generated function printInstruction().
The operand 0 ($rc) didn&#8217;t be printed in printInstruction() since assembly
print $ra and $rb only.
In the CMP decode function, we didn&#8217;t decode shamt field because we
don&#8217;t want it to be displayed and it&#8217;s not in the assembler print pattern of
Cpu0InstrInfo.td.</p>
<p>The RET (Cpu0ISD::Ret) and JR (ISD::BRIND) are both for &#8220;ret&#8221; instruction.
The former is for instruction encode in assembly and obj while the latter is
for decode in disassembler.
The IR node Cpu0ISD::Ret is created in LowerReturn() which called at function
exit point.</p>
<p>Now, run Chapter9_1/ with command <tt class="docutils literal"><span class="pre">llvm-objdump</span> <span class="pre">-d</span> <span class="pre">ch7_1_1.cpu0.o</span></tt> will get
the following result.</p>
<div class="highlight-bash"><div class="highlight"><pre>JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_
build/bin/Debug/llc -march<span class="o">=</span>cpu0 -relocation-model<span class="o">=</span>pic -filetype<span class="o">=</span>obj
ch7_1_1.bc -o ch7_1_1.cpu0.o
JonathantekiiMac:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_
build/bin/Debug/llvm-objdump -d ch7_1_1.cpu0.o

ch7_1_1.cpu0.o:       file format ELF32-CPU0

Disassembly of section .text:
main:
       0:     09 dd ff d8                                     addiu   <span class="nv">$sp</span>, <span class="nv">$sp</span>, -40
       4:     09 30 00 00                                     addiu   <span class="nv">$3</span>, <span class="nv">$zero</span>, 0
       8:     02 3d 00 24                                     st      <span class="nv">$3</span>, 36<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
       c:     02 3d 00 20                                     st      <span class="nv">$3</span>, 32<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      10:     09 20 00 01                                     addiu   <span class="nv">$2</span>, <span class="nv">$zero</span>, 1
      14:     02 2d 00 1c                                     st      <span class="nv">$2</span>, 28<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      18:     09 40 00 02                                     addiu   <span class="nv">$4</span>, <span class="nv">$zero</span>, 2
      1c:     02 4d 00 18                                     st      <span class="nv">$4</span>, 24<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      20:     09 40 00 03                                     addiu   <span class="nv">$4</span>, <span class="nv">$zero</span>, 3
      24:     02 4d 00 14                                     st      <span class="nv">$4</span>, 20<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      28:     09 40 00 04                                     addiu   <span class="nv">$4</span>, <span class="nv">$zero</span>, 4
      2c:     02 4d 00 10                                     st      <span class="nv">$4</span>, 16<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      30:     09 40 00 05                                     addiu   <span class="nv">$4</span>, <span class="nv">$zero</span>, 5
      34:     02 4d 00 0c                                     st      <span class="nv">$4</span>, 12<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      38:     09 40 00 06                                     addiu   <span class="nv">$4</span>, <span class="nv">$zero</span>, 6
      3c:     02 4d 00 08                                     st      <span class="nv">$4</span>, 8<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      40:     09 40 00 07                                     addiu   <span class="nv">$4</span>, <span class="nv">$zero</span>, 7
      44:     02 4d 00 04                                     st      <span class="nv">$4</span>, 4<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      48:     09 40 00 08                                     addiu   <span class="nv">$4</span>, <span class="nv">$zero</span>, 8
      4c:     02 4d 00 00                                     st      <span class="nv">$4</span>, 0<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      50:     01 4d 00 20                                     ld      <span class="nv">$4</span>, 32<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      54:     28 40 00 0c                                     bne     <span class="nv">$4</span>, <span class="nv">$zero</span>, 12
      58:     01 4d 00 20                                     ld      <span class="nv">$4</span>, 32<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      5c:     09 44 00 01                                     addiu   <span class="nv">$4</span>, <span class="nv">$4</span>, 1
      60:     02 4d 00 20                                     st      <span class="nv">$4</span>, 32<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      64:     01 4d 00 1c                                     ld      <span class="nv">$4</span>, 28<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      68:     27 40 00 0c                                     beq     <span class="nv">$4</span>, <span class="nv">$zero</span>, 12
      6c:     01 4d 00 1c                                     ld      <span class="nv">$4</span>, 28<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      70:     09 44 00 01                                     addiu   <span class="nv">$4</span>, <span class="nv">$4</span>, 1
      74:     02 4d 00 1c                                     st      <span class="nv">$4</span>, 28<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      78:     01 4d 00 18                                     ld      <span class="nv">$4</span>, 24<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      7c:     0a 44 00 01                                     slti    <span class="nv">$4</span>, <span class="nv">$4</span>, 1
      80:     28 40 00 0c                                     bne     <span class="nv">$4</span>, <span class="nv">$zero</span>, 12
      84:     01 4d 00 18                                     ld      <span class="nv">$4</span>, 24<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      88:     09 44 00 01                                     addiu   <span class="nv">$4</span>, <span class="nv">$4</span>, 1
      8c:     02 4d 00 18                                     st      <span class="nv">$4</span>, 24<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      90:     01 4d 00 14                                     ld      <span class="nv">$4</span>, 20<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      94:     0a 44 00 00                                     slti    <span class="nv">$4</span>, <span class="nv">$4</span>, 0
      98:     28 40 00 0c                                     bne     <span class="nv">$4</span>, <span class="nv">$zero</span>, 12
      9c:     01 4d 00 14                                     ld      <span class="nv">$4</span>, 20<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      a0:     09 44 00 01                                     addiu   <span class="nv">$4</span>, <span class="nv">$4</span>, 1
      a4:     02 4d 00 14                                     st      <span class="nv">$4</span>, 20<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      a8:     01 4d 00 10                                     ld      <span class="nv">$4</span>, 16<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      ac:     09 50 ff ff                                     addiu   <span class="nv">$5</span>, <span class="nv">$zero</span>, -1
      b0:     20 45 40 00                                     slt     <span class="nv">$4</span>, <span class="nv">$5</span>, <span class="nv">$4</span>
      b4:     28 40 00 0c                                     bne     <span class="nv">$4</span>, <span class="nv">$zero</span>, 12
      b8:     01 4d 00 10                                     ld      <span class="nv">$4</span>, 16<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      bc:     09 44 00 01                                     addiu   <span class="nv">$4</span>, <span class="nv">$4</span>, 1
      c0:     02 4d 00 10                                     st      <span class="nv">$4</span>, 16<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      c4:     01 4d 00 0c                                     ld      <span class="nv">$4</span>, 12<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      c8:     20 33 40 00                                     slt     <span class="nv">$3</span>, <span class="nv">$3</span>, <span class="nv">$4</span>
      cc:     28 30 00 0c                                     bne     <span class="nv">$3</span>, <span class="nv">$zero</span>, 12
      d0:     01 3d 00 0c                                     ld      <span class="nv">$3</span>, 12<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      d4:     09 33 00 01                                     addiu   <span class="nv">$3</span>, <span class="nv">$3</span>, 1
      d8:     02 3d 00 0c                                     st      <span class="nv">$3</span>, 12<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      dc:     01 3d 00 08                                     ld      <span class="nv">$3</span>, 8<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      e0:     20 22 30 00                                     slt     <span class="nv">$2</span>, <span class="nv">$2</span>, <span class="nv">$3</span>
      e4:     28 20 00 0c                                     bne     <span class="nv">$2</span>, <span class="nv">$zero</span>, 12
      e8:     01 2d 00 08                                     ld      <span class="nv">$2</span>, 8<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      ec:     09 22 00 01                                     addiu   <span class="nv">$2</span>, <span class="nv">$2</span>, 1
      f0:     02 2d 00 08                                     st      <span class="nv">$2</span>, 8<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      f4:     01 2d 00 04                                     ld      <span class="nv">$2</span>, 4<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
      f8:     0a 22 00 01                                     slti    <span class="nv">$2</span>, <span class="nv">$2</span>, 1
      <span class="nb">fc</span>:     28 20 00 0c                                     bne     <span class="nv">$2</span>, <span class="nv">$zero</span>, 12
     100:     01 2d 00 04                                     ld      <span class="nv">$2</span>, 4<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
     104:     09 22 00 01                                     addiu   <span class="nv">$2</span>, <span class="nv">$2</span>, 1
     108:     02 2d 00 04                                     st      <span class="nv">$2</span>, 4<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
     10c:     01 2d 00 04                                     ld      <span class="nv">$2</span>, 4<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
     110:     01 3d 00 00                                     ld      <span class="nv">$3</span>, 0<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
     114:     20 23 20 00                                     slt     <span class="nv">$2</span>, <span class="nv">$3</span>, <span class="nv">$2</span>
     118:     27 20 00 0c                                     beq     <span class="nv">$2</span>, <span class="nv">$zero</span>, 12
     11c:     01 2d 00 00                                     ld      <span class="nv">$2</span>, 0<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
     120:     09 22 00 01                                     addiu   <span class="nv">$2</span>, <span class="nv">$2</span>, 1
     124:     02 2d 00 00                                     st      <span class="nv">$2</span>, 0<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
     128:     01 2d 00 1c                                     ld      <span class="nv">$2</span>, 28<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
     12c:     01 3d 00 20                                     ld      <span class="nv">$3</span>, 32<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
     130:     27 32 00 0c                                     beq     <span class="nv">$3</span>, <span class="nv">$2</span>, 12
     134:     01 2d 00 20                                     ld      <span class="nv">$2</span>, 32<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
     138:     09 22 00 01                                     addiu   <span class="nv">$2</span>, <span class="nv">$2</span>, 1
     13c:     02 2d 00 20                                     st      <span class="nv">$2</span>, 32<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
     140:     01 2d 00 20                                     ld      <span class="nv">$2</span>, 32<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
     144:     09 dd 00 28                                     addiu   <span class="nv">$sp</span>, <span class="nv">$sp</span>, 40
     148:     2c 00 00 00                                     ret     <span class="nv">$zero</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dynamic-link">
<h2>Dynamic link<a class="headerlink" href="#dynamic-link" title="Permalink to this headline">¶</a></h2>
<p>We expain how the dynamic link work for Cpu0 even though the Cpu0 linker and
dynamic linker not exist at this point. Same with other parts, Cpu0 dynamic link
implementation borrowed from Mips ABI. We trace the dynamic link implementation
by lldb on X86 platform. Finding X86 and Mips all use the plt as the dynamic link
implementation.</p>
<div class="section" id="linker-support">
<h3>Linker support<a class="headerlink" href="#linker-support" title="Permalink to this headline">¶</a></h3>
<p>In this section, it shows what&#8217;s the code that comipler generate to support
dynamic link. And what&#8217;s the code generated by linker for dyanmic link.</p>
<p>Compile main.cpp to get the Cpu0 PIC assembly code as follows,</p>
<p class="rubric">LLVMBackendTutorialExampleCode/InputFiles/main.cpp</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">extern</span> <span class="kt">int</span> <span class="n">foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">x1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x2</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">bar</span><span class="p">();</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">a</span> <span class="o">+=</span> <span class="n">foo</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
  <span class="n">a</span> <span class="o">+=</span> <span class="n">bar</span><span class="p">();</span>
  
  <span class="k">return</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre>18-165-77-200:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_build/
bin/Debug/llc -march<span class="o">=</span>cpu0 -relocation-model<span class="o">=</span>pic -filetype<span class="o">=</span>asm  main.bc -o -
        .section .mdebug.abi32
        .previous
        .file <span class="s2">&quot;main.bc&quot;</span>
        .text
        .globl        main
        .align        2
        .type main,@function
        .ent  main                    <span class="c"># @main</span>
main:
        .cfi_startproc
        .frame        <span class="nv">$sp</span>,40,<span class="nv">$lr</span>
        .mask         0x00004080,-4
        .set  noreorder
        .cpload       <span class="nv">$t9</span>
        .set  nomacro
<span class="c"># BB#0:</span>
        addiu <span class="nv">$sp</span>, <span class="nv">$sp</span>, -40
<span class="nv">$tmp2</span>:
        .cfi_def_cfa_offset 40
        st    <span class="nv">$lr</span>, 36<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>            <span class="c"># 4-byte Folded Spill</span>
        st    <span class="nv">$7</span>, 32<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>             <span class="c"># 4-byte Folded Spill</span>
<span class="nv">$tmp3</span>:
        .cfi_offset 14, -4
<span class="nv">$tmp4</span>:
        .cfi_offset 7, -8
        .cprestore    8
        addiu <span class="nv">$2</span>, <span class="nv">$zero</span>, 0
        st    <span class="nv">$2</span>, 28<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
        addiu <span class="nv">$2</span>, <span class="nv">$zero</span>, 2
        st    <span class="nv">$2</span>, 4<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
        addiu <span class="nv">$2</span>, <span class="nv">$zero</span>, 1
        st    <span class="nv">$2</span>, 0<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
        ld    <span class="nv">$7</span>, %call24<span class="o">(</span>_Z3fooii<span class="o">)(</span><span class="nv">$gp</span><span class="o">)</span>
        add   <span class="nv">$6</span>, <span class="nv">$zero</span>, <span class="nv">$7</span>
        jalr  <span class="nv">$6</span>
        ld    <span class="nv">$gp</span>, 8<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
        st    <span class="nv">$2</span>, 24<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
        addiu <span class="nv">$2</span>, <span class="nv">$zero</span>, 4
        st    <span class="nv">$2</span>, 4<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
        addiu <span class="nv">$2</span>, <span class="nv">$zero</span>, 3
        st    <span class="nv">$2</span>, 0<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
        add   <span class="nv">$6</span>, <span class="nv">$zero</span>, <span class="nv">$7</span>
        jalr  <span class="nv">$6</span>
        ld    <span class="nv">$gp</span>, 8<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
        ld    <span class="nv">$3</span>, 24<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
        add   <span class="nv">$2</span>, <span class="nv">$3</span>, <span class="nv">$2</span>
        st    <span class="nv">$2</span>, 24<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
        ld    <span class="nv">$6</span>, %call24<span class="o">(</span>_Z3barv<span class="o">)(</span><span class="nv">$gp</span><span class="o">)</span>
        jalr  <span class="nv">$6</span>
        ld    <span class="nv">$gp</span>, 8<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
        ld    <span class="nv">$3</span>, 24<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
        add   <span class="nv">$2</span>, <span class="nv">$3</span>, <span class="nv">$2</span>
        st    <span class="nv">$2</span>, 24<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>
        ld    <span class="nv">$7</span>, 32<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>             <span class="c"># 4-byte Folded Reload</span>
        ld    <span class="nv">$lr</span>, 36<span class="o">(</span><span class="nv">$sp</span><span class="o">)</span>            <span class="c"># 4-byte Folded Reload</span>
        addiu <span class="nv">$sp</span>, <span class="nv">$sp</span>, 40
        ret   <span class="nv">$2</span>
        .set  macro
        .set  reorder
        .end  main
<span class="nv">$tmp5</span>:
        .size main, <span class="o">(</span><span class="nv">$tmp5</span><span class="o">)</span>-main
        .cfi_endproc

118-165-77-200:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_build/
bin/Debug/llc -march<span class="o">=</span>cpu0 -relocation-model<span class="o">=</span>pic -filetype<span class="o">=</span>obj  main.bc -o
main.cpu0.o
118-165-77-200:InputFiles Jonathan<span class="nv">$ </span>/Users/Jonathan/llvm/test/cmake_debug_build/
bin/Debug/llvm-objdump -r main.cpu0.o

main.cpu0.o:  file format ELF32-CPU0

RELOCATION RECORDS FOR <span class="o">[</span>.text<span class="o">]</span>:
4 R_CPU0_LO16 _gp_disp
52 R_CPU0_CALL24 _Z3fooii
112 R_CPU0_CALL24 _Z3barv

RELOCATION RECORDS FOR <span class="o">[</span>.eh_frame<span class="o">]</span>:
28 R_CPU0_32 .text
</pre></div>
</div>
<p>Suppost we have the linker which support dynamic link of Cpu0.
After linker, the plt for dynamic link function _Z5fooii and _Z3barv are
solved and the ELF file looks like the following,</p>
<div class="highlight-bash"><div class="highlight"><pre>SYMBOL TABLE:
...
0040035c l    d  .dynsym      00000000              .dynsym
...

Disassembly of section .plt:
...
00400720 &lt;_Z3barv@plt&gt;:
  400720:     lui     <span class="nv">$8</span>,0x41
  400724:     ld      <span class="nv">$6</span>,0x0acc<span class="o">(</span><span class="nv">$8</span><span class="o">)</span>
  400738:     addiu   <span class="nv">$9</span>,<span class="nv">$zero</span>,0x18
  40073c:     jr      <span class="nv">$6</span>

00400730 &lt;_Z3fooii@plt&gt;:
  400730:     lui     <span class="nv">$8</span>,0x41
  400734:     ld      <span class="nv">$6</span>,0x0ado<span class="o">(</span><span class="nv">$8</span><span class="o">)</span>
  400738:     addiu   <span class="nv">$9</span>,<span class="nv">$zero</span>,0x08
  40073c:     jr      <span class="nv">$6</span>
  ...
004009f0 &lt;.CPU0.stubs&gt;:
  4009F0: 8f998010  ld        <span class="nv">$6</span>,-32752<span class="o">(</span>gp<span class="o">)</span>
  4009F4: 03e07821 add        <span class="nv">$8</span>,<span class="nv">$zero</span>, lr
  4009F8: 0320f809  jalr      <span class="nv">$6</span>
</pre></div>
</div>
</div>
<div class="section" id="principle">
<h3>Principle<a class="headerlink" href="#principle" title="Permalink to this headline">¶</a></h3>
<p>To support dynamic link, Cpu0 set the protocal as Table registers changed for
call dynamic link function _Z3fooii(). The .dynsym+0x08 include the dynamic
link function information. Usually the information include which
library and the offset value in this library. This information can be got and
saved in ELF file in link time.</p>
<p>After the ELF is loaded to memory, it looks like <a class="pageref" href="#elf-f2">Figure  2</a></p>
<div class="figure align-center" id="elf-f2">
<a class="reference internal image-reference" href="_images/21.png"><img alt="_images/21.png" src="_images/21.png" style="width: 798.0px; height: 804.0px;" /></a>
<p class="caption">Figure 2: Call dynamic function _Z3fooii() first time</p>
</div>
<table border="1" class="docutils">
<caption>registers changed for call dynamic link function _Z3fooii()</caption>
<colgroup>
<col width="28%" />
<col width="39%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">register/memory</th>
<th class="head">call _Z3fooii first time</th>
<th class="head">call _Z3fooii second time</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x410ad0</td>
<td>point to CPU0.stubs</td>
<td>point to _Z3fooii</td>
</tr>
<tr class="row-odd"><td>.dynsym+0x08</td>
<td>(libfoobar.so, offset, length) about _Z3fooii</td>
<td>useless</td>
</tr>
<tr class="row-even"><td>-32752(gp)</td>
<td>point to dynamic_linker</td>
<td>useless</td>
</tr>
<tr class="row-odd"><td>$8</td>
<td>the next instruction of _Z3fooii()</td>
<td>useless</td>
</tr>
<tr class="row-even"><td>$9</td>
<td>.dynsym+0x08</td>
<td>useless</td>
</tr>
<tr class="row-odd"><td>$6 (at the end of <a class="reference external" href="mailto:_Z3fooii&#37;&#52;&#48;plt">_Z3fooii<span>&#64;</span>plt</a>)</td>
<td>point to CPU0.stubs0</td>
<td>point to _Z3fooii</td>
</tr>
<tr class="row-even"><td>$6 (at the end of CPU0.stubs)</td>
<td>point to dynamic_linker</td>
<td>useless</td>
</tr>
</tbody>
</table>
<p>Explains it as follows,</p>
<ol class="arabic simple">
<li>As you can see, the first time of function call, a = foo(1,2), which is
implemented
by instructions &#8220;ld $7, %call24(<a class="reference external" href="mailto:_Z3fooii&#37;&#52;&#48;plt">_Z3fooii<span>&#64;</span>plt</a>)($gp)&#8221;, &#8220;add $6, $zero, $7&#8221; and
&#8220;jalr $6&#8221;. Remember, .dynsym+0x08 contains information (libfoobar.so,
offset, length) which is set by linker at link to dynamic shared library.
After &#8220;jalr $6&#8221;, PC counter jump to &#8220;00400730 &lt;<a class="reference external" href="mailto:_Z3fooii&#37;&#52;&#48;plt">_Z3fooii<span>&#64;</span>plt</a>&gt;&#8221;.</li>
<li>The memory 0x410ad0 contents is the address of CPU0.stubs when the program,
main(), is loaded.</li>
<li>After <a class="reference external" href="mailto:_Z3fooii&#37;&#52;&#48;plt">_Z3fooii<span>&#64;</span>plt</a> instructions executed, it jump to CPU0.stubs since $6 = the
address of CPU0.stubs. Register $9 = the contents of address .dynsym+0x08 since
it is set in step 1.</li>
<li>After CPU0.stubs is executed, register $8 = 0x004008a4 which point to the
caller next instruction in step 1.</li>
<li>Dynamic linker looks into register $9 which value is 0x08. It ask OS for
the caller process address information of .dynsym + offset 0x08. This
address include information (libfoobar.so, offset, length). With this
information, dynamic linker knows where can get _Z3fooii function body.
Dynamic linker loads _Z3fooii() function body to an available
address where from asking OS. After load _Z3fooii(), it call _Z3fooii() and
save and restore the registers $6, $8, $9 and caller saved registers just
before and after call _Z3fooii().</li>
<li>After _Z3fooii() return, dynamic linker set the contents of address 0x410ad0
to the entry address of _Z3fooii in memory.</li>
<li>Dynamic linker execute jr $8. It jump to the next instruction of
&#8220;a = _Z3fooii();&#8221; in caller.</li>
</ol>
<p>After the _Z3fooii() is called at second time, it looks like
<a class="pageref" href="#elf-f3">Figure  3</a>. It jump to _Z3fooii() directly in &lt;<a class="reference external" href="mailto:_Z3fooii&#37;&#52;&#48;plt">_Z3fooii<span>&#64;</span>plt</a>&gt; since
the contents of address 0x410ad0 is changed to the memory address of _Z3fooii()
at step 6 of <a class="pageref" href="#elf-f2">Figure  2</a>. From now on, any call _Z3fooii() will
jump to _Z3fooii() directly from <a class="reference external" href="mailto:_Z3fooii&#37;&#52;&#48;plt">_Z3fooii<span>&#64;</span>plt</a> instructions.</p>
<div class="figure align-center" id="elf-f3">
<a class="reference internal image-reference" href="_images/31.png"><img alt="_images/31.png" src="_images/31.png" style="width: 744.0px; height: 788.0px;" /></a>
<p class="caption">Figure 3: Call dynamic function _Z3fooii() second time</p>
</div>
<p>According Mips Application Binary Interface (ABI), $t9 is register alias
for $25 in Mips. The %t9 is the register
used in jalr $25 for long distance function pointer (far subroutine call).
Cpu0 use register $6 as the $t9 ($25) register of Mips.
The jal %subroutine has 24 bits range of address offset relative to Program
Counter (PC) while jalr has 32 bits address range in register size of 32 bits.
One example of PIC mode is used in share library just like this example.
Share library is re-entry code which can be loaded in different memory address
decided on run time. The jalr make the implementation of dynamic link function
easier and faster as above.</p>
</div>
<div class="section" id="trace-with-lldb">
<h3>Trace with lldb<a class="headerlink" href="#trace-with-lldb" title="Permalink to this headline">¶</a></h3>
<p>We tracking the dynamic link on X86 as below. You can skip it if you have no
interest or already know how to track it via lldb or gdb.</p>
<div class="highlight-bash"><div class="highlight"><pre>118-165-77-200:InputFiles Jonathan<span class="nv">$ </span>clang -fPIC -g -c foobar.cpp
118-165-77-200:InputFiles Jonathan<span class="nv">$ </span>clang -shared -g foobar.o -o libfoobar.so
118-165-77-200:InputFiles Jonathan<span class="nv">$ </span>clang -g -c main.cpp
118-165-77-200:InputFiles Jonathan<span class="nv">$ </span>clang -g main.o libfoobar.so
118-165-77-200:InputFiles Jonathan<span class="nv">$ </span>gobjdump -d main.o

main.o:     fileformat mach-o-x86-64

Disassembly of section .text:

0000000000000000 &lt;_main&gt;:
   0: 55                      push   %rbp
   1: 48 89 e5                mov    %rsp,%rbp
   4: 48 83 ec 10             sub    <span class="nv">$0x10</span>,%rsp
   8: bf 01 00 00 00          mov    <span class="nv">$0x1</span>,%edi
   d: be 02 00 00 00          mov    <span class="nv">$0x2</span>,%esi
  12: c7 45 <span class="nb">fc </span>00 00 00 00    movl   <span class="nv">$0x0</span>,-0x4<span class="o">(</span>%rbp<span class="o">)</span>
  19: e8 00 00 00 00          callq  1e &lt;_main+0x1e&gt;
  1e: bf 03 00 00 00          mov    <span class="nv">$0x3</span>,%edi
  23: be 04 00 00 00          mov    <span class="nv">$0x4</span>,%esi
  28: 89 45 f8                mov    %eax,-0x8<span class="o">(</span>%rbp<span class="o">)</span>
  2b: e8 00 00 00 00          callq  30 &lt;_main+0x30&gt;
  30: 8b 75 f8                mov    -0x8<span class="o">(</span>%rbp<span class="o">)</span>,%esi
  33: 01 c6                   add    %eax,%esi
  35: 89 75 f8                mov    %esi,-0x8<span class="o">(</span>%rbp<span class="o">)</span>
  38: e8 00 00 00 00          callq  3d &lt;_main+0x3d&gt;
  3d: 8b 75 f8                mov    -0x8<span class="o">(</span>%rbp<span class="o">)</span>,%esi
  40: 01 c6                   add    %eax,%esi
  42: 89 75 f8                mov    %esi,-0x8<span class="o">(</span>%rbp<span class="o">)</span>
  45: 8b 45 f8                mov    -0x8<span class="o">(</span>%rbp<span class="o">)</span>,%eax
  48: 48 83 c4 10             add    <span class="nv">$0x10</span>,%rsp
  4c: 5d                      pop    %rbp
  4d: c3                      retq

118-165-77-200:InputFiles Jonathan<span class="nv">$ </span>gobjdump -d a.out
...
main.o:     fileformat mach-o-x86-64

Disassembly of section .text:

0000000100000ef0 &lt;_main&gt;:
   100000ef0: 55                      push   %rbp
   100000ef1: 48 89 e5                mov    %rsp,%rbp
   100000ef4: 48 83 ec 10             sub    <span class="nv">$0x10</span>,%rsp
   100000ef8: bf 01 00 00 00          mov    <span class="nv">$0x1</span>,%edi
   100000efd: be 02 00 00 00          mov    <span class="nv">$0x2</span>,%esi
   100000f02: c7 45 <span class="nb">fc </span>00 00 00 00    movl   <span class="nv">$0x0</span>,-0x4<span class="o">(</span>%rbp<span class="o">)</span>
   100000f09: e8 36 00 00 00          callq  100000f44 &lt;__Z3fooii<span class="nv">$stub</span>&gt;
   100000f0e: bf 03 00 00 00          mov    <span class="nv">$0x3</span>,%edi
   100000f13: be 04 00 00 00          mov    <span class="nv">$0x4</span>,%esi
   100000f18: 89 45 f8                mov    %eax,-0x8<span class="o">(</span>%rbp<span class="o">)</span>
   100000f1b: e8 24 00 00 00          callq  100000f44 &lt;__Z3fooii<span class="nv">$stub</span>&gt;
   100000f20: 8b 75 f8                mov    -0x8<span class="o">(</span>%rbp<span class="o">)</span>,%esi
   100000f23: 01 c6                   add    %eax,%esi
   100000f25: 89 75 f8                mov    %esi,-0x8<span class="o">(</span>%rbp<span class="o">)</span>
   100000f28: e8 11 00 00 00          callq  100000f3e &lt;__Z3barv<span class="nv">$stub</span>&gt;
   100000f2d: 8b 75 f8                mov    -0x8<span class="o">(</span>%rbp<span class="o">)</span>,%esi
   100000f30: 01 c6                   add    %eax,%esi
   100000f32: 89 75 f8                mov    %esi,-0x8<span class="o">(</span>%rbp<span class="o">)</span>
   100000f35: 8b 45 f8                mov    -0x8<span class="o">(</span>%rbp<span class="o">)</span>,%eax
   100000f38: 48 83 c4 10             add    <span class="nv">$0x10</span>,%rsp
   100000f3c: 5d                      pop    %rbp
   100000f3d: c3                      retq

Disassembly of section __TEXT.__stubs:

0000000100000f3e &lt;__Z3barv<span class="nv">$stub</span>&gt;:
   100000f3e: ff 25 cc 00 00 00       jmpq   *0xcc<span class="o">(</span>%rip<span class="o">)</span>        <span class="c"># 100001010</span>
   &lt;__Z3barv<span class="nv">$stub</span>&gt;

0000000100000f44 &lt;__Z3fooii<span class="nv">$stub</span>&gt;:
   100000f44: ff 25 ce 00 00 00       jmpq   *0xce<span class="o">(</span>%rip<span class="o">)</span>        <span class="c"># 100001018</span>
   &lt;__Z3fooii<span class="nv">$stub</span>&gt;

Disassembly of section __TEXT.__stub_helper:

0000000100000f4c &lt;__TEXT.__stub_helper&gt;:
   100000f4c: 4c 8d 1d b5 00 00 00    lea    0xb5<span class="o">(</span>%rip<span class="o">)</span>,%r11        <span class="c"># 100001008 &lt;&gt;</span>
   100000f53: 41 53                   push   %r11
   100000f55: ff 25 a5 00 00 00       jmpq   *0xa5<span class="o">(</span>%rip<span class="o">)</span>        <span class="c"># 100001000</span>
   &lt;dyld_stub_binder<span class="nv">$stub</span>&gt;
   100000f5b: 90                      nop
   100000f5c: 68 00 00 00 00          pushq  <span class="nv">$0x0</span>
   100000f61: e9 e6 ff ff ff          jmpq   100000f4c &lt;__Z3fooii<span class="nv">$stub</span>+0x8&gt;
   100000f66: 68 0f 00 00 00          pushq  <span class="nv">$0xf</span>
   100000f6b: e9 dc ff ff ff          jmpq   100000f4c &lt;__Z3fooii<span class="nv">$stub</span>+0x8&gt;

Disassembly of section __TEXT.__unwind_info:
   ...




118-165-77-200:InputFiles Jonathan<span class="nv">$ </span>lldb a.out
Current executable <span class="nb">set </span>to <span class="s1">&#39;a.out&#39;</span> <span class="o">(</span>x86_64<span class="o">)</span>.
<span class="o">(</span>lldb<span class="o">)</span> run main
Process 702 launched: <span class="s1">&#39;/Users/Jonathan/test/lbd/docs/BackendTutorial/</span>
<span class="s1">LLVMBackendTutorialExampleCode/InputFiles/a.out&#39;</span> <span class="o">(</span>x86_64<span class="o">)</span>
Process 702 exited with <span class="nv">status</span> <span class="o">=</span> 15 <span class="o">(</span>0x0000000f<span class="o">)</span>
<span class="o">(</span>lldb<span class="o">)</span> b main
Breakpoint 1: <span class="nv">where</span> <span class="o">=</span> a.out<span class="sb">`</span>main + 25 at main.cpp:7, <span class="nv">address</span> <span class="o">=</span> 0x0000000100000f09
<span class="o">(</span>lldb<span class="o">)</span> target stop-hook add
Enter your stop hook <span class="nb">command</span><span class="o">(</span>s<span class="o">)</span>.  Type <span class="s1">&#39;DONE&#39;</span> to end.
&gt; disassemble --pc
&gt; DONE
Stop hook <span class="c">#1 added.</span>
<span class="o">(</span>lldb<span class="o">)</span> run
Process 705 launched: <span class="s1">&#39;/Users/Jonathan/test/lbd/docs/BackendTutorial/</span>
<span class="s1">LLVMBackendTutorialExampleCode/InputFiles/a.out&#39;</span> <span class="o">(</span>x86_64<span class="o">)</span>
dyld<span class="sb">`</span>_dyld_start:
-&gt; 0x7fff5fc01028:  popq   %rdi
   0x7fff5fc01029:  pushq  <span class="nv">$0</span>
   0x7fff5fc0102b:  movq   %rsp, %rbp
   0x7fff5fc0102e:  andq   <span class="nv">$-</span>16, %rsp
Process 753 stopped
* thread <span class="c">#1: tid = 0x1c03, 0x0000000100000f09 a.out`main + 25 at main.cpp:7,</span>
stop <span class="nv">reason</span> <span class="o">=</span> breakpoint 1.1
    frame <span class="c">#0: 0x0000000100000f09 a.out`main + 25 at main.cpp:7</span>
   4
   5          int main<span class="o">()</span>
   6          <span class="o">{</span>
-&gt; 7            int <span class="nv">a</span> <span class="o">=</span> foo<span class="o">(</span>1, 2<span class="o">)</span>;
   8            a +<span class="o">=</span> foo<span class="o">(</span>3, 4<span class="o">)</span>;
   9            a +<span class="o">=</span> bar<span class="o">()</span>;
   10
a.out<span class="sb">`</span>main + 25 at main.cpp:7:
-&gt; 0x100000f09:  callq  0x100000f44               ; symbol stub <span class="k">for</span>: foo<span class="o">(</span>int, int<span class="o">)</span>
   0x100000f0e:  movl   <span class="nv">$3</span>, %edi
   0x100000f13:  movl   <span class="nv">$4</span>, %esi
   0x100000f18:  movl   %eax, -8<span class="o">(</span>%rbp<span class="o">)</span>
<span class="o">(</span>lldb<span class="o">)</span> stepi
Process 753 stopped
* thread <span class="c">#1: tid = 0x1c03, 0x0000000100000f44 a.out`foo(int, int), stop reason</span>
<span class="o">=</span> instruction step into
    frame <span class="c">#0: 0x0000000100000f44 a.out`foo(int, int)</span>
a.out<span class="sb">`</span>symbol stub <span class="k">for</span>: foo<span class="o">(</span>int, int<span class="o">)</span>:
-&gt; 0x100000f44:  jmpq   *206<span class="o">(</span>%rip<span class="o">)</span>                ; <span class="o">(</span>void *<span class="o">)</span>0x0000000100000f66
a.out<span class="sb">`</span>symbol stub <span class="k">for</span>: foo<span class="o">(</span>int, int<span class="o">)</span>:
-&gt; 0x100000f44:  jmpq   *206<span class="o">(</span>%rip<span class="o">)</span>                ; <span class="o">(</span>void *<span class="o">)</span>0x0000000100000f66
   0x100000f4a:  addb   %al, <span class="o">(</span>%rax<span class="o">)</span>
   0x100000f4c:  addb   %al, <span class="o">(</span>%rax<span class="o">)</span>
   0x100000f4e:  addb   %al, <span class="o">(</span>%rax<span class="o">)</span>
<span class="o">(</span>lldb<span class="o">)</span> p <span class="nv">$rip</span>
<span class="o">(</span>unsigned long<span class="o">)</span> <span class="nv">$1</span> <span class="o">=</span> 4294971204
<span class="o">(</span>lldb<span class="o">)</span> memory <span class="nb">read</span>/4xw 4294971410
0x100001012: 0x00010000 0x0f660000 0x00010000 0x00000000
<span class="o">(</span>lldb<span class="o">)</span> stepi
Process 859 stopped
* thread <span class="c">#1: tid = 0x1c03, 0x0000000100000f66 a.out, stop reason = instruction</span>
    step into frame <span class="c">#0: 0x0000000100000f66 a.out</span>
-&gt; 0x100000f66:  pushq  <span class="nv">$15</span>
   0x100000f6b:  jmpq   0x100000f4c
-&gt; 0x100000f66:  pushq  <span class="nv">$15</span>
   0x100000f6b:  jmpq   0x100000f4c
   0x100000f70:  addb   %al, <span class="o">(</span>%rax<span class="o">)</span>
   0x100000f72:  addb   %al, <span class="o">(</span>%rax<span class="o">)</span>
<span class="o">)</span> stepistepi
Process 859 stopped
* thread <span class="c">#1: tid = 0x1c03, 0x0000000100000f6b a.out, stop reason = instruction</span>
    step into frame <span class="c">#0: 0x0000000100000f6b a.out</span>
-&gt; 0x100000f6b:  jmpq   0x100000f4c
-&gt; 0x100000f6b:  jmpq   0x100000f4c
   0x100000f70:  addb   %al, <span class="o">(</span>%rax<span class="o">)</span>
   0x100000f72:  addb   %al, <span class="o">(</span>%rax<span class="o">)</span>
   0x100000f74:  addb   %al, <span class="o">(</span>%rax<span class="o">)</span>
<span class="o">(</span>lldb<span class="o">)</span> stepi
Process 859 stopped
* thread <span class="c">#1: tid = 0x1c03, 0x0000000100000f4c a.out, stop reason = instruction</span>
    step into frame <span class="c">#0: 0x0000000100000f4c a.out</span>
-&gt; 0x100000f4c:  leaq   181<span class="o">(</span>%rip<span class="o">)</span>, %r11           ; <span class="o">(</span>void *<span class="o">)</span>0x0000000000000000
   0x100000f53:  pushq  %r11
   0x100000f55:  jmpq   *165<span class="o">(</span>%rip<span class="o">)</span>                ; <span class="o">(</span>void *<span class="o">)</span>0x00007fff978da878:
   dyld_stub_binder
   0x100000f5b:  nop
-&gt; 0x100000f4c:  leaq   181<span class="o">(</span>%rip<span class="o">)</span>, %r11           ; <span class="o">(</span>void *<span class="o">)</span>0x0000000000000000
   0x100000f53:  pushq  %r11
   0x100000f55:  jmpq   *165<span class="o">(</span>%rip<span class="o">)</span>                ; <span class="o">(</span>void *<span class="o">)</span>0x00007fff978da878:
   dyld_stub_binder
   0x100000f5b:  nop
<span class="o">(</span>lldb<span class="o">)</span>
Process 859 stopped
* thread <span class="c">#1: tid = 0x1c03, 0x0000000100000f53 a.out, stop reason = instruction</span>
    step into frame <span class="c">#0: 0x0000000100000f53 a.out</span>
-&gt; 0x100000f53:  pushq  %r11
   0x100000f55:  jmpq   *165<span class="o">(</span>%rip<span class="o">)</span>                ; <span class="o">(</span>void *<span class="o">)</span>0x00007fff978da878:
   dyld_stub_binder
   0x100000f5b:  nop
   0x100000f5c:  pushq  <span class="nv">$0</span>
-&gt; 0x100000f53:  pushq  %r11
   0x100000f55:  jmpq   *165<span class="o">(</span>%rip<span class="o">)</span>                ; <span class="o">(</span>void *<span class="o">)</span>0x00007fff978da878:
   dyld_stub_binder
   0x100000f5b:  nop
   0x100000f5c:  pushq  <span class="nv">$0</span>
<span class="o">(</span>lldb<span class="o">)</span>
Process 859 stopped
* thread <span class="c">#1: tid = 0x1c03, 0x0000000100000f55 a.out, stop reason = instruction</span>
    step into frame <span class="c">#0: 0x0000000100000f55 a.out</span>
-&gt; 0x100000f55:  jmpq   *165<span class="o">(</span>%rip<span class="o">)</span>                ; <span class="o">(</span>void *<span class="o">)</span>0x00007fff978da878:
   dyld_stub_binder
   0x100000f5b:  nop
   0x100000f5c:  pushq  <span class="nv">$0</span>
   0x100000f61:  jmpq   0x100000f4c
-&gt; 0x100000f55:  jmpq   *165<span class="o">(</span>%rip<span class="o">)</span>                ; <span class="o">(</span>void *<span class="o">)</span>0x00007fff978da878:
   dyld_stub_binder
   0x100000f5b:  nop
   0x100000f5c:  pushq  <span class="nv">$0</span>
   0x100000f61:  jmpq   0x100000f4c
<span class="o">(</span>lldb<span class="o">)</span>
Process 859 stopped
* thread <span class="c">#1: tid = 0x1c03, 0x00007fff978da878 libdyld.dylib`dyld_stub_binder,</span>
    stop <span class="nv">reason</span> <span class="o">=</span> instruction step into
    frame <span class="c">#0: 0x00007fff978da878 libdyld.dylib`dyld_stub_binder</span>
libdyld.dylib<span class="sb">`</span>dyld_stub_binder:
-&gt; 0x7fff978da878:  pushq  %rbp
   0x7fff978da879:  movq   %rsp, %rbp
   0x7fff978da87c:  subq   <span class="nv">$192</span>, %rsp
   0x7fff978da883:  movq   %rdi, <span class="o">(</span>%rsp<span class="o">)</span>
libdyld.dylib<span class="sb">`</span>dyld_stub_binder:
-&gt; 0x7fff978da878:  pushq  %rbp
   0x7fff978da879:  movq   %rsp, %rbp
   0x7fff978da87c:  subq   <span class="nv">$192</span>, %rsp
   0x7fff978da883:  movq   %rdi, <span class="o">(</span>%rsp<span class="o">)</span>
<span class="o">(</span>lldb<span class="o">)</span> cont
Process 753 resuming
Process 753 stopped
* thread <span class="c">#1: tid = 0x1c03, 0x0000000100000f1b a.out`main + 43 at main.cpp:8,</span>
    stop <span class="nv">reason</span> <span class="o">=</span> breakpoint 2.1
    frame <span class="c">#0: 0x0000000100000f1b a.out`main + 43 at main.cpp:8</span>
   5          int main<span class="o">()</span>
   6          <span class="o">{</span>
   7            int <span class="nv">a</span> <span class="o">=</span> foo<span class="o">(</span>1, 2<span class="o">)</span>;
-&gt; 8            a +<span class="o">=</span> foo<span class="o">(</span>3, 4<span class="o">)</span>;
   9            a +<span class="o">=</span> bar<span class="o">()</span>;
   10
   11           <span class="k">return </span>a;
a.out<span class="sb">`</span>main + 43 at main.cpp:8:
-&gt; 0x100000f1b:  callq  0x100000f44               ; symbol stub <span class="k">for</span>: foo<span class="o">(</span>int, int<span class="o">)</span>
   0x100000f20:  movl   -8<span class="o">(</span>%rbp<span class="o">)</span>, %esi
   0x100000f23:  addl   %eax, %esi
   0x100000f25:  movl   %esi, -8<span class="o">(</span>%rbp<span class="o">)</span>
<span class="o">(</span>lldb<span class="o">)</span> stepi
Process 753 stopped
* thread <span class="c">#1: tid = 0x1c03, 0x0000000100000f44 a.out`foo(int, int), stop reason =</span>
    instruction step into frame <span class="c">#0: 0x0000000100000f44 a.out`foo(int, int)</span>
a.out<span class="sb">`</span>symbol stub <span class="k">for</span>: foo<span class="o">(</span>int, int<span class="o">)</span>:
-&gt; 0x100000f44:  jmpq   *206<span class="o">(</span>%rip<span class="o">)</span>                ; <span class="o">(</span>void *<span class="o">)</span>0x0000000100003f20:
   foo<span class="o">(</span>int, int<span class="o">)</span> at /Users/Jonathan/test/lbd/docs/BackendTutorial/LLVMBackendT
   utorialExampleCode/InputFiles/foobar.cpp:3
a.out<span class="sb">`</span>symbol stub <span class="k">for</span>: foo<span class="o">(</span>int, int<span class="o">)</span>:
-&gt; 0x100000f44:  jmpq   *206<span class="o">(</span>%rip<span class="o">)</span>                ; <span class="o">(</span>void *<span class="o">)</span>0x0000000100003f20:
   foo<span class="o">(</span>int, int<span class="o">)</span> at /Users/Jonathan/test/lbd/docs/BackendTutorial/LLVMBackendT
   utorialExampleCode/InputFiles/foobar.cpp:3
   0x100000f4a:  addb   %al, <span class="o">(</span>%rax<span class="o">)</span>
   0x100000f4c:  addb   %al, <span class="o">(</span>%rax<span class="o">)</span>
   0x100000f4e:  addb   %al, <span class="o">(</span>%rax<span class="o">)</span>
<span class="o">(</span>lldb<span class="o">)</span> p <span class="nv">$rip</span>
<span class="o">(</span>unsigned long<span class="o">)</span> <span class="nv">$2</span> <span class="o">=</span> 4294971204
<span class="o">(</span>lldb<span class="o">)</span> memory <span class="nb">read</span>/4xw 4294971410
0x100001012: 0x00010000 0x3f200000 0x00010000 0x00000000
<span class="o">(</span>lldb<span class="o">)</span> stepi
Process 753 stopped
* thread <span class="c">#1: tid = 0x1c03, 0x0000000100003f20 libfoobar.so`foo(x1=0, x2=3) at</span>
    foobar.cpp:3, stop <span class="nv">reason</span> <span class="o">=</span> instruction step into
    frame <span class="c">#0: 0x0000000100003f20 libfoobar.so`foo(x1=0, x2=3) at foobar.cpp:3</span>
   1
   2          int foo<span class="o">(</span>int x1, int x2<span class="o">)</span>
-&gt; 3          <span class="o">{</span>
   4            int <span class="nv">sum</span> <span class="o">=</span> x1 + x2;
   5
   6            <span class="k">return </span>sum;
libfoobar.so<span class="sb">`</span>foo<span class="o">(</span>int, int<span class="o">)</span> at foobar.cpp:3:
-&gt; 0x100003f20:  pushq  %rbp
   0x100003f21:  movq   %rsp, %rbp
   0x100003f24:  movl   %edi, -4<span class="o">(</span>%rbp<span class="o">)</span>
   0x100003f27:  movl   %esi, -8<span class="o">(</span>%rbp<span class="o">)</span>
<span class="o">(</span>lldb<span class="o">)</span>
</pre></div>
</div>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="http://en.wikipedia.org/wiki/Executable_and_Linkable_Format">http://en.wikipedia.org/wiki/Executable_and_Linkable_Format</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="http://jonathan2251.github.com/lbd/install.html#install-other-tools-on-imac">http://jonathan2251.github.com/lbd/install.html#install-other-tools-on-imac</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>Leland Beck, System Software: An Introduction to Systems Programming.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="http://ccckmit.wikidot.com/lk:aout">http://ccckmit.wikidot.com/lk:aout</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><a class="reference external" href="http://ccckmit.wikidot.com/lk:objfile">http://ccckmit.wikidot.com/lk:objfile</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[6]</a></td><td><a class="reference external" href="http://ccckmit.wikidot.com/lk:elf">http://ccckmit.wikidot.com/lk:elf</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[7]</a></td><td><a class="reference external" href="http://lld.llvm.org/">http://lld.llvm.org/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id15" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[8]</td><td><a class="reference external" href="http://developer.mips.com/clang-llvm/">http://developer.mips.com/clang-llvm/</a></td></tr>
</tbody>
</table>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="funccall.html">Function call</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="runbackend.html">Run backend</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, LLVM.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>